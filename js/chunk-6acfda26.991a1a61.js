(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6acfda26"],{"4e4f":function(e,t,i){},"79d1":function(e,t,i){e.exports=i.p+"img/formula_1.06e58d72.png"},"9ac6":function(e,t,i){e.exports=i.p+"img/formula_2.57a667cc.png"},e2e3:function(e,t,i){"use strict";i("4e4f")},ece7:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Row",[n("page-filter",{ref:"pageFilter",attrs:{"page-rooter":"chinaCohort","can-select-all-version":e.canSelectAllVersion,loading:e.tableLoading,"all-media-sources":e.canSelectAllMediasource,"can-select-allmodel":e.canSelectAllmodel},on:{"on-filter-apply":e.onFilterApply}})],1),n("Row",{staticStyle:{"margin-top":"5px"}},[n("Card",{attrs:{shadow:""}},[n("Tabs",{on:{"on-click":e.handleCohortChange},model:{value:e.currCohort,callback:function(t){e.currCohort=t},expression:"currCohort"}},e._l(e.allCohorts,(function(e,t){return n("TabPane",{key:t,attrs:{label:e.label,name:e.val}})})),1),n("div",{staticClass:"radioGroupItem"},[n("Select",{staticStyle:{width:"95px"},on:{"on-change":e.handleCohoreTypeChange},model:{value:e.tabSelectDay,callback:function(t){e.tabSelectDay=t},expression:"tabSelectDay"}},e._l(e.daysOptions,(function(t,i){return n("Option",{key:i,attrs:{value:t}},[e._v(e._s(t+"天"))])})),1),e._v(" \n        "),n("RadioGroup",{attrs:{type:"button"},on:{"on-change":e.handleCohoreTypeChange},model:{value:e.cohortType,callback:function(t){e.cohortType=t},expression:"cohortType"}},[n("Radio",{attrs:{label:"grand_total",disabled:e.disableTotal}},[e._v("累计")]),n("Radio",{attrs:{label:"on_the_day",disabled:e.disableDay}},[e._v("当日")])],1)],1),e.status?n("div",{staticClass:"placementItem"},[n("span",[e._v("选择广告位：")]),n("a-select",{staticClass:"inline-width",staticStyle:{"font-size":"12px"},attrs:{mode:"multiple",allowClear:"",filterable:"",showArrow:"",autoClearSearchValue:!1,placeholder:"选择广告位-全部",optionFilterProp:"children","max-tag-count":this.maxTagArr[0],"max-tag-text-length":this.maxTagTextArr[0]},on:{focus:function(t){return e.focusFun(0)},blur:function(t){return e.blurFun()},mouseenter:function(t){return e.mouseenterFun(0)},mouseleave:function(t){return e.mouseleaveFun()},change:e.handlePlacement},model:{value:e.placement,callback:function(t){e.placement=t},expression:"placement"}},e._l(e.allPlacement,(function(t,i){return n("a-option",{key:i,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1),n("span",{on:{mouseenter:function(t){return e.setVisible(1)}}},["avimpression"===e.currCohort?n("Icon",{staticClass:"iconItem",attrs:{type:"md-help-circle"}}):e._e()],1),n("div",{staticClass:"optionsContents",attrs:{id:"placementOptions"}},e._l(e.tmpOptions,(function(t){return n("li",{key:t},[e._v(e._s(t))])})),0)],1):e._e(),n("table-data",{ref:"table",attrs:{data:e.tableData,"table-loading":e.tableLoading,days:e.days,"all-app":e.allApp,"all-media-source":e.allMediaSource,"all-mediabuy-channel":e.allMediabuyChannel,"footer-data":e.totalData,"page-reset":e.pageReset,"page-data":e.pageData,"field-formaters":e.field_formaters,"known-fields":e.china_cohort,dimensions:e.currDimensions,metrics:e.metrics,fixMetrics:!0,"all-cohorts":e.allCohorts,"curr-cohort":e.currCohort,"curr-cohort-type":e.cohortType,"day-range":e.dayRange,"money-type":e.moneyType,"default-dimensions":e.defaultDimensions,"all-dimensions":e.allDimensions,"curr-all-dimensions":e.currAllDimensions,"all-metrics":e.allMetrics,"sync-dimensions":e.syncDimensions,"sync-metrics":e.syncMetrics,"page-rooter":"chinaCohort","tab-select-day":e.tabSelectDay},on:{"on-sort-change":e.handleSortChange,"metrics-ok":e.metricsOk,"on-table-refresh":e.handleTableRefresh,"on-download":e.download,"on-page-change":e.pageChange,"on-page-size-change":e.pageSizeChange,"on-page-reset-true":e.pageResetFalse,"on-dimensions-change":e.handleDimensionsChange}})],1),e.downloadLoading?n("Spin",{attrs:{size:"large",fix:""}}):e._e()],1),n("Modal",{attrs:{"footer-hide":!0,title:"计算公式",width:500},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("b",[e._v("计算方式")])]),n("Card",[n("p",{staticClass:"p_title"},[e._v("情形1: 当筛选指定广告位时或者维度包含广告位时:")]),n("p",[e._v("假设计算2020/11/20至2020/11/25期间“A+B+广告位”三个维度day n的人均展示次数，那么，")]),n("p",{staticClass:"p_img"},[n("img",{staticClass:"formula_img",attrs:{src:i("79d1")}})]),n("p",{staticClass:"p_title"},[e._v("情形2: 当筛选条件和维度都不包含广告位时:")]),n("p",[e._v("假设计算2020/11/20至2020/11/25期间“A+B+C”三个维度day n的人均展示次数，且A/B/C均不是广告位，那么，")]),n("p",{staticClass:"p_img"},[n("img",{staticClass:"formula_img",attrs:{src:i("9ac6")}})])]),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{on:{click:function(t){return e.setVisible(2)}}},[e._v("取消")])],1)],1)],1)},s=[],a=(i("8e6e"),i("456d"),i("20d6"),i("ac6a"),i("5df3"),i("ade3")),r=i("45a2"),o=i("8b2b"),l=i("bdcb"),c=i("9839"),h=i("90de"),u=i("4481"),p=i("2f62"),d=(i("ca62"),i("4b65")),m=i("1157"),f=i.n(m);function g(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function y(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?g(Object(i),!0).forEach((function(t){Object(a["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var b={name:"china-cohort",components:{PageFilter:r["a"],LineChart:o["a"],TableData:l["a"],ASelect:c["d"],AOption:c["d"].Option},data:function(){return{tabItem:"name1",inited:!1,rowGutter:20,defaultDimensions:["date"],knownDimensions:["year","quarterly","month","date","project","app_name","media_source","app_version","os_version","device_brand","std_device_model","placement"],knownMetrics:["um_dnu","cost","media_cpi"],inFields:[["projects","project"],["apps","app_id"],["mediaSources","media_source"],["appVersions","app_version"],["os_version","os_version"],["device_brand","device_brand"],["std_device_model","std_device_model"],["placement","placement"]],knownCohorts:["roi","revenue","ads_arpu","ecpm","avimpression","retention"],metrics:[],currFilterApply:{},currSortField:{},currDimensions:[],currMetrics:[],currDownloadParams:{},currPageIndex:1,currPageSize:100,currCohort:"roi",cohortType:"grand_total",disableDay:!1,disableTotal:!1,moneyType:"¥",pageReset:!1,tableLoading:!0,chartLoading:!0,downloadLoading:!1,syncDimensions:[],syncMetrics:[],tabSelectDay:30,caculateSelectDay:30,daysOptions:[30,60,90,180],currDimensionsLengthfocusFun:1,currAllDimensions:[],placement:[],allPlacement:[],status:!1,maxTagArr:[1,1],maxTagTextArr:[20,20],tmpAllOptions:[],tmpOptions:[],width_:1360,mark:0,canSelectAllVersion:[],canSelectAllmodel:[],canSelectAllMediasource:[],visible:!1}},computed:y(y({},Object(p["d"])({field_formaters:function(e){return e.dashboard_field.field_formaters},china_cohort:function(e){return e.dashboard_field.china_cohort},allApp:function(e){return e.app_reporting.allApp},allMediaSource:function(e){return e.media_source.chinaMediaSource},allMediabuyChannel:function(e){return e.media_source.chinaMediabuyChannel},tableData:function(e){if(!0===this.inited)return e.china_cohort.chinaCohortTableData.data},totalData:function(e){if(!0===this.inited){var t=e.china_cohort.chinaCohortTotalData.data;if(t&&t.length>0)return t[0]}},pageData:function(e){if(!0===this.inited){var t=e.china_cohort.chinaCohortTableData,i={page_size:t.page_size,has_next:t.has_next,has_prev:t.has_prev,total_num:t.total_num};return i}}})),{},{allDimensions:function(){return Object(d["j"])(this.china_cohort,this.knownDimensions)},allMetrics:function(){return Object(d["j"])(this.china_cohort,this.knownMetrics)},allCohorts:function(){return Object(d["j"])(this.china_cohort,this.knownCohorts)},days:function(){var e=Object(d["h"])(this.currFilterApply);return e},dayRange:function(){return Object(d["f"])(this.currFilterApply,this.currDimensions,"chinaCohort",this.caculateSelectDay)}}),methods:y(y({},Object(p["b"])(["getChinaCohortTableData","getChinaCohortTotalData","getChinaCohortDownloadUrl","getFilterlist"])),{},{onFilterApply:function(e){this.currFilterApply=JSON.parse(JSON.stringify(e)),this.status&&(this.currFilterApply.placement=this.placement),this.currSortField={},this.currDimensions=JSON.parse(JSON.stringify(this.currDimensions)),this.currPageIndex=1,this.pageReset=!0,this.updatePageData(1)},handleSortChange:function(e,t,i){this.currPageIndex=1,this.currSortField={key:e.key,order:e.order},this.pageReset=!0,this.updateTableData(2)},handleTableRefresh:function(e,t){if(this.currDimensions=JSON.parse(JSON.stringify(e)),0===this.currDimensions.length){this.currDimensionsLength=0;var i=JSON.stringify(this.knownDimensions);!1===this.status&&(i=JSON.stringify(this.knownDimensions.filter((function(e){return"placement"!==e})))),this.currDimensions=JSON.parse(i)}else this.currDimensionsLength=1;if(this.currMetrics=t,this.currSortField={},this.currMetrics=t,this.metrics=t,0===this.currMetrics.length){var n=JSON.stringify(this.knownMetrics);this.currMetrics=JSON.parse(n),this.metrics=JSON.parse(n)}this.currPageIndex=1,(this.currFilterApply&&this.currFilterApply.rangeDates&&this.status||this.status)&&(this.currFilterApply.placement=this.placement),this.updateTableData(1),this.updateTotalData(),this.pageReset=!0},handleDimensionsChange:function(e){if(this.syncDimensions=JSON.parse(JSON.stringify(e)),0===e.length){var t=JSON.stringify(this.knownDimensions);this.syncDimensions=JSON.parse(t)}},handleCohortChange:function(e){this.status&&(this.currFilterApply.placement=this.placement),this.showRule(e),this.updatePageData(1)},showRule:function(e){"retention"===e?(this.disableDay=!1,this.cohortType="on_the_day",this.disableTotal=!0):(this.disableTotal=!1,this.disableDay=!1),this.currPageIndex=1,this.pageReset=!0,this.currSortField={},"revenue"===e||"ecpm"===e||"avimpression"===e?this.status=!0:(this.status=!1,delete this.currFilterApply.placement),this.dealDimensions(e),this.updatePageData(1,2)},dealDimensions:function(e){if(0===this.currDimensions.length){var t=JSON.stringify(this.knownDimensions);!1===this.status&&(t=JSON.stringify(this.knownDimensions.filter((function(e){return"placement"!==e})))),this.currDimensions=JSON.parse(t)}else!1===this.status?(this.currDimensions=this.currDimensions.filter((function(e){return"placement"!==e})),this.currDimensions.length<1&&(this.currDimensions=this.defaultDimensions)):this.currDimensions.length===this.allDimensions.length-1&&-1===this.currDimensions.indexOf("placement")&&this.currDimensions.push("placement");this.currAllDimensions="revenue"!==e&&"ecpm"!==e&&"avimpression"!==e?this.allDimensions.filter((function(e,t){return"placement"!==e.val})):this.allDimensions},daysChange:function(e){},handleCohoreTypeChange:function(e){var t=this;this.currPageIndex=1,this.pageReset=!0,setTimeout((function(){t.caculateSelectDay=t.tabSelectDay}),50),this.updatePageData(1)},metricsOk:function(e){this.currMetrics=e,this.metrics=e,this.syncMetrics=JSON.parse(JSON.stringify(e)),this.metrics.length<=0&&(this.metrics=JSON.parse(JSON.stringify(this.knownMetrics)),this.syncMetrics=JSON.parse(JSON.stringify(this.knownMetrics)))},download:function(e){this.currDownloadParams=JSON.parse(JSON.stringify(e)),this.downloadFile()},pageChange:function(e){this.currPageIndex=e,this.updateTableData(1)},pageSizeChange:function(e){this.currPageSize=e,this.pageReset=!0,this.updateTableData(1,1)},setDefaultDimensionsAndMetrics:function(){var e=JSON.stringify(this.defaultDimensions);this.currDimensions=JSON.parse(e),this.syncDimensions=JSON.parse(e),e=JSON.stringify(this.knownMetrics),this.metrics=JSON.parse(e),this.currMetrics=JSON.parse(e),this.syncMetrics=JSON.parse(e)},updateTableData:function(e,t){var i=this;this.tableLoading=!0;var n=this.wrapTableReqParams(e,t);this.getChinaCohortTableData(n).then((function(e){i.tableLoading=!1})).catch((function(e){i.tableLoading=!1,i.showError(e)}))},updateTotalData:function(){var e=this,t=this.wrapTotalReqParams();this.placement&&this.placement.length>0&&this.status&&-1!==this.currDimensions.indexOf("placement")&&(t.has_placement=!0),this.getChinaCohortTotalData(t).then((function(e){})).catch((function(t){return e.showError(t)}))},updatePageData:function(e,t){var i=this;this.tableLoading=!0,this.chartLoading=!0,Promise.all([this.getChinaCohortTableData(this.wrapTableReqParams(e,t)),this.getChinaCohortTotalData(this.wrapTotalReqParams())]).then((function(e){i.inited=!0,i.tableLoading=!1,i.chartLoading=!1})).catch((function(e){i.tableLoading=!1,i.chartLoading=!1,i.showError(e)}))},downloadFile:function(){var e=this;this.downloadLoading=!0;var t=this.wrapDownloadReqParams();this.getChinaCohortDownloadUrl(t).then((function(t){e.downloadLoading=!1;var i=document.createElement("a");i.href=t.url,i.click()})).catch((function(t){e.downloadLoading=!1,e.showError(t)}))},wrapTableReqParams:function(e,t){this.status&&(this.currFilterApply.placement=this.placement);var i={time_range:Object(d["r"])(this.currFilterApply),page:JSON.stringify({count:2===e||1===t?1:this.currPageIndex,size:this.currPageSize}),filtering:Object(d["m"])(this.currFilterApply,this.inFields),group_by:Object(d["n"])(this.currDimensions),fields:Object(d["l"])(this.knownMetrics),sort:Object(d["p"])(this.currSortField,e,this.currDimensions,this.currDimensionsLength),show_type:this.currCohort,statistic_type:this.cohortType,period:this.tabSelectDay};return i},wrapTotalReqParams:function(){var e={time_range:Object(d["r"])(this.currFilterApply),filtering:Object(d["m"])(this.currFilterApply,this.inFields),fields:Object(d["l"])(this.knownMetrics),show_type:this.currCohort,statistic_type:this.cohortType,query_type:"summary",period:this.tabSelectDay};return(this.placement&&this.placement.length>0&&this.status||-1!==this.currDimensions.indexOf("placement"))&&(e.has_placement=!0),-1===this.currDimensions.indexOf("placement")&&-1===this.currDimensions.indexOf("std_device_model")&&-1===this.currDimensions.indexOf("device_brand")&&-1===this.currDimensions.indexOf("os_version")&&-1===this.currDimensions.indexOf("app_version")&&-1===this.currDimensions.indexOf("media_source")||(e.no_cpi=!0),e},wrapDownloadReqParams:function(){var e=this.currDownloadParams.basic_metrics,t=this.currDownloadParams.core_metrics,i={time_range:Object(d["r"])(this.currFilterApply),filtering:Object(d["m"])(this.currFilterApply,this.inFields),group_by:Object(d["n"])(this.currDownloadParams.dimensions,!0),fields:Object(d["l"])(e),show_type:t,statistic_type:this.currDownloadParams.cohortType,file_format:this.currDownloadParams.fileFormat,period:this.currDownloadParams.period};return i},onSelectPageInfo:function(e){var t=JSON.parse(e);this.$refs.pageFilter.setFilter(t.filter),this.currCohort=t.currCohort,this.cohortType=t.cohortType,this.tabSelectDay=t.tabSelectDay,this.$refs.table.$refs.childTableDimensions.setData(t.dimensions),this.currDimensions=JSON.parse(JSON.stringify(t.dimensions.dimensions.length>0?t.dimensions.dimensions:this.knownDimensions)),this.metrics=JSON.parse(JSON.stringify(t.dimensions.metrics.length>0?t.dimensions.metrics:this.knownMetrics)),t.filter.time_type&&(t.filter.rangeDates=Object(h["f"])(t.filter.time_type)),this.placement=t.placement,this.showRule(t.currCohort),this.onFilterApply(t.filter)},onGetPageInfo:function(e){var t=this.$refs.pageFilter.getFilter(),i=this.$refs.table.$refs.childTableDimensions.getData(),n={filter:t,currCohort:this.currCohort,cohortType:this.cohortType,tabSelectDay:this.tabSelectDay,dimensions:i};this.status&&(n.placement=this.placement);var s=JSON.stringify(n);u["a"].$emit("setPageInfo",e,s)},showError:function(e){this.$Modal.error({title:"Error",content:e})},pageResetFalse:function(){this.pageReset=!1},getPlacement:function(){var e=this;this.getFilterlist().then((function(t){e.allPlacement=t&&t.placement?t.placement:[],e.allPlacement=e.allPlacement.filter((function(e){return!!e.id})),e.canSelectAllVersion=t&&t.os_version?t.os_version:[],e.canSelectAllVersion=e.canSelectAllVersion.filter((function(e){return!!e.id})),e.canSelectAllmodel=t&&t.std_device_model?t.std_device_model:[],e.canSelectAllMediasource=t&&t.install_channel?t.install_channel:[],e.canSelectAllMediasource=e.canSelectAllMediasource.filter((function(e){return!!e.id}))}))},handlePlacement:function(e){this.currFilterApply&&this.currFilterApply.rangeDates,this.currFilterApply.placement=this.placement,this.updatePageData(1)},focusFun:function(e){this.mark=1,f()("#placementOptions").length&&f()("#placementOptions").css({display:"none"}),this.maxTagArr=[1,1],this.maxTagTextArr=[20,20];var t=this;setTimeout((function(){t.maxTagArr.splice(e,0,100),t.maxTagTextArr.splice(e,0,100)}),500)},blurFun:function(){this.mark=0,this.maxTagArr.findIndex((function(e){return 100===e}))>=0&&(this.maxTagArr=[1,1],this.maxTagTextArr=[20,20]),this.setItemValues()},mouseenterFun:function(e){if(1!==this.mark){var t,i;this.tmpOptions=this.tmpAllOptions[e],this.width_<1530?(t=1===e?298:84,i=0===e||1===e?32:92):this.width_>1700?(t=1===e?298:84,i=0===e||1===e?32:94):(t=1===e?298:84,i=0===e||1===e?32:92);var n=document.getElementById("placementOptions");f()("#placementOptions").length&&this.tmpOptions&&this.tmpOptions.length>0&&n&&(f()("#placementOptions").css({display:"block",left:t+"px"}),n.style.setProperty("top",i+"px","important"),n.style.setProperty("display","block","important"))}},mouseleaveFun:function(){this.hideContentItem(),this.setItemValues()},setItemValues:function(){this.tmpAllOptions[0]=this.placement},hideContentItem:function(){var e=document.getElementById("placementOptions");e&&(e.style.display="none")},_expandable:function(){this.width_=document.body.clientWidth},setVisible:function(e){this.visible=1===e}}),mounted:function(){var e=this;this.dealDimensions(),this.getPlacement(),this.setDefaultDimensionsAndMetrics(),this.updatePageData(),this._expandable(),window.onresize=function(){return function(){e._expandable()}()};var t=this;u["a"].$on("selectPageInfo",(function(e){t.onSelectPageInfo(e)})),u["a"].$on("getPageInfo",(function(e){t.onGetPageInfo(e)}))},beforeDestroy:function(){u["a"].$off("selectPageInfo"),u["a"].$off("getPageInfo")}},D=b,_=(i("e2e3"),i("2877")),O=Object(_["a"])(D,n,s,!1,null,"4e6093a4",null);t["default"]=O.exports}}]);