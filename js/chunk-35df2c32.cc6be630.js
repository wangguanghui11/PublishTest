(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-35df2c32"],{"3c23":function(t,e,a){},"9a7d":function(t,e,a){"use strict";a("3c23")},e877:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",[a("page-filter",{ref:"pageFilter",attrs:{"page-rooter":"abroadCohort",loading:t.tableLoading},on:{"on-filter-apply":t.onFilterApply}})],1),a("Row",{staticStyle:{"margin-top":"5px"}},[a("Card",{attrs:{shadow:""}},[a("RadioGroup",{staticClass:"radioWapper",on:{"on-change":t.handleCohortChange},model:{value:t.currCohort,callback:function(e){t.currCohort=e},expression:"currCohort"}},t._l(t.allCohorts,(function(e,r){return a("Radio",{key:r,staticStyle:{"margin-top":"10px","margin-bottom":"10px"},attrs:{label:e.val}},[t._v(t._s(e.label))])})),1),a("Divider"),a("div",[a("span",{directives:[{name:"show",rawName:"v-show",value:t.showCalculateBy,expression:"showCalculateBy"}],staticStyle:{"margin-right":"10px"}},[t._v("by")]),a("Select",{directives:[{name:"show",rawName:"v-show",value:t.showCalculateBy,expression:"showCalculateBy"}],staticStyle:{width:"140px"},on:{"on-change":t.handleCalculateByChange},model:{value:t.calculateBy,callback:function(e){t.calculateBy=e},expression:"calculateBy"}},t._l(t.knownCalculateByArr,(function(e,r){return a("Option",{key:r,attrs:{value:e.val}},[t._v(t._s(e.label))])})),1),a("RadioGroup",{staticStyle:{"margin-left":"10px"},attrs:{type:"button"},on:{"on-change":t.handleCohoreTypeChange},model:{value:t.cohortType,callback:function(e){t.cohortType=e},expression:"cohortType"}},[a("Radio",{attrs:{label:"grand_total",disabled:t.disableTotal}},[t._v("累计")]),a("Radio",{attrs:{label:"on_the_day",disabled:t.disableDay}},[t._v("当日")])],1)],1),a("Divider"),a("table-data",{ref:"table",attrs:{data:t.tableData,"table-loading":t.tableLoading,days:t.days,"all-app":t.allApp,"all-media-source":t.allMediaSource,"footer-data":t.totalData,"page-reset":t.pageReset,"page-data":t.pageData,"field-formaters":t.field_formaters,"known-fields":t.abroad_cohort,dimensions:t.currDimensions,metrics:t.metrics,fixMetrics:!0,"all-cohorts":t.allDownloadCohorts,"all-special-cohorts":t.allDownloadSpecialCohorts,"curr-cohort":t.currDownloadCohort,"calculate-by":t.calculateBy,"curr-cohort-type":t.cohortType,"day-range":t.dayRange,"default-dimensions":t.defaultDimensions,"all-dimensions":t.allDimensions,"all-calculation-method":t.knownCalculateBy,"all-metrics":t.allMetrics,"sync-dimensions":t.syncDimensions,"sync-metrics":t.syncMetrics,"page-rooter":"abroadCohort"},on:{"on-sort-change":t.handleSortChange,"metrics-ok":t.metricsOk,"on-table-refresh":t.handleTableRefresh,"on-download":t.download,"on-page-change":t.pageChange,"on-page-size-change":t.pageSizeChange,"on-page-reset-true":t.pageResetFalse,"on-dimensions-change":t.handleDimensionsChange}})],1),t.downloadLoading?a("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)],1)},i=[],o=(a("8e6e"),a("456d"),a("ac6a"),a("5df3"),a("ade3")),s=a("0df7"),n=a("8b2b"),l=a("bdcb"),c=a("90de"),h=a("2f62"),u=(a("ca62"),a("4b65")),d=a("4481");function p(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function g(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?p(Object(a),!0).forEach((function(e){Object(o["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var y={name:"abroad-cohort",components:{PageFilter:s["a"],LineChart:n["a"],TableData:l["a"]},data:function(){return{tabItem:"name1",inited:!1,rowGutter:20,defaultDimensions:["date"],knownDimensions:["year","quarter","month","date","project","app_type","app_name","media_source","country","campaign","optimizer"],knownMetrics:["installs","cost","average_cpi"],inFields:[["projects","project"],["apps","app_id"],["mediaSources","media_source"],["countries","country"],["appTypes","app_type"],["optimizer","optimizer"],["campaign","campaign"]],knownCohorts:["roi","sum_revenue","ad_revenue","iap_revenue","sum_arpu","ads_arpu","ecpm","avimpression","click_ad_button","ad_show_fail","non_ad_users_percentage","iap_avg_revenue","iap_avg_times","pay_rate","retention","staytime","enter_homepage"],knownDownloadCohorts:["roi","retention","ads_arpu","ecpm"],knownDownloadSpecialCohorts:["roi","sum_revenue","ad_revenue","iap_revenue","sum_arpu","ads_arpu","ecpm","avimpression","click_ad_button","ad_show_fail","non_ad_users_percentage","iap_avg_revenue","iap_avg_times","pay_rate","retention","staytime","enter_homepage"],knownCalculateBy:[{val:"installs",label:"Installs"},{val:"retention_users",label:"Active Users"},{val:"unique_users",label:"Engaged Users"}],likeFields:[["adWord","adLike","campaign"]],metrics:[],currFilterApply:{},currSortField:{},currDimensions:[],currMetrics:[],currDownloadParams:{},currPageIndex:1,currPageSize:100,currCohort:"roi",currDownloadCohort:"roi",cohortType:"grand_total",disableDay:!1,disableTotal:!1,calculateBy:"installs",showCalculateBy:!1,pageReset:!1,tableLoading:!0,chartLoading:!0,downloadLoading:!1,syncDimensions:[],syncMetrics:[],knownCalculateByArr:[]}},computed:g(g({},Object(h["d"])({field_formaters:function(t){return t.dashboard_field.field_formaters},abroad_cohort:function(t){return t.dashboard_field.abroad_cohort},allApp:function(t){return t.app_reporting.allApp},allMediaSource:function(t){return t.media_source.abroadMediaSource},tableData:function(t){if(!0===this.inited)return t.abroad_cohort.abroadCohortTableData.data},totalData:function(t){if(!0===this.inited){var e=t.abroad_cohort.abroadCohortTotalData.data;if(e&&e.length>0)return e[0]}},pageData:function(t){if(!0===this.inited){var e=t.abroad_cohort.abroadCohortTableData,a={page_size:e.page_size,has_next:e.has_next,has_prev:e.has_prev,total_num:e.total_num};return a}}})),{},{allDimensions:function(){return Object(u["j"])(this.abroad_cohort,this.knownDimensions)},allMetrics:function(){return Object(u["j"])(this.abroad_cohort,this.knownMetrics)},allCohorts:function(){return Object(u["j"])(this.abroad_cohort,this.knownCohorts)},allDownloadCohorts:function(){return Object(u["j"])(this.abroad_cohort,this.knownDownloadCohorts)},allDownloadSpecialCohorts:function(){return Object(u["j"])(this.abroad_cohort,this.knownDownloadSpecialCohorts)},days:function(){var t=Object(u["h"])(this.currFilterApply);return t},dayRange:function(){return Object(u["f"])(this.currFilterApply,this.currDimensions)}}),methods:g(g({},Object(h["b"])(["getAbroadCohortTableData","getAbroadCohortTotalData","getAbroadCohortDownloadUrl"])),{},{onFilterApply:function(t){this.currFilterApply=JSON.parse(JSON.stringify(t)),this.currSortField={},this.currDimensions=JSON.parse(JSON.stringify(this.currDimensions)),this.currPageIndex=1,this.pageReset=!0,this.updatePageData(1)},handleSortChange:function(t,e,a){this.currPageIndex=1,this.currSortField={key:t.key,order:t.order},this.pageReset=!0,this.updateTableData(2)},handleTableRefresh:function(t,e){if(this.currDimensions=JSON.parse(JSON.stringify(t)),0===this.currDimensions.length){this.currDimensionsLength=0;var a=JSON.stringify(this.knownDimensions);this.currDimensions=JSON.parse(a)}else this.currDimensionsLength=1;if(this.currMetrics=e,this.currSortField={},this.currMetrics=e,this.metrics=e,0===this.currMetrics.length){var r=JSON.stringify(this.knownMetrics);this.currMetrics=JSON.parse(r),this.metrics=JSON.parse(r)}this.currPageIndex=1,this.updateTableData(1),this.updateTotalData(),this.pageReset=!0},handleDimensionsChange:function(t){if(this.syncDimensions=JSON.parse(JSON.stringify(t)),0===t.length){var e=JSON.stringify(this.knownDimensions);this.syncDimensions=JSON.parse(e)}},handleCohortChange:function(t){this.showRule(),this.currPageIndex=1,this.pageReset=!0,this.currSortField={},this.updatePageData(1)},handleCalculateByChange:function(t){this.showRule(),this.currPageIndex=1,this.pageReset=!0,this.updatePageData(1)},showRule:function(){this.knownCalculateByArr=this.knownCalculateBy,"retention"===this.currCohort?(this.showCalculateBy=!1,this.disableDay=!1,this.disableTotal=!0,this.cohortType="on_the_day"):"non_ad_users_percentage"===this.currCohort||"iap_arppu"===this.currCohort?(this.showCalculateBy=!1,this.disableTotal=!0,this.disableDay=!1,this.cohortType="on_the_day"):"enter_homepage"===this.currCohort||"pay_rate"===this.currCohort?(this.knownCalculateByArr=this.knownCalculateBy.filter((function(t){return"unique_users"!==t.val})),this.showCalculateBy=!0,this.disableDay=!1,this.disableTotal=!0,this.cohortType="on_the_day","unique_users"===this.calculateBy&&(this.calculateBy="installs")):"staytime"===this.currCohort||"avimpression"===this.currCohort||"click_ad_button"===this.currCohort||"ad_show_fail"===this.currCohort||"iap_avg_revenue"===this.currCohort||"iap_avg_times"===this.currCohort?(this.showCalculateBy=!0,"installs"===this.calculateBy?(this.disableDay=!1,this.disableTotal=!1):(this.disableDay=!1,this.disableTotal=!0,this.cohortType="on_the_day")):(this.showCalculateBy=!1,this.disableDay=!1,this.disableTotal=!1,this.knownCalculateByArr=this.knownCalculateBy),this.currDownloadCohort=this.currCohort,"staytime"===this.currCohort?("installs"===this.calculateBy||"unique_users"===this.calculateBy||"retention_users"===this.calculateBy)&&(this.currDownloadCohort="staytime"):"avimpression"===this.currCohort&&("installs"===this.calculateBy||"unique_users"===this.calculateBy||"retention_users"===this.calculateBy)&&(this.currDownloadCohort="avimpression")},handleCohoreTypeChange:function(t){this.currPageIndex=1,this.pageReset=!0,this.updatePageData(1)},metricsOk:function(t){this.currMetrics=t,this.metrics=t,this.syncMetrics=JSON.parse(JSON.stringify(t)),this.metrics.length<=0&&(this.metrics=JSON.parse(JSON.stringify(this.knownMetrics)),this.syncMetrics=JSON.parse(JSON.stringify(this.knownMetrics)))},download:function(t){this.currDownloadParams=JSON.parse(JSON.stringify(t)),this.downloadFile()},pageChange:function(t){this.currPageIndex=t,this.updateTableData(1)},pageSizeChange:function(t){this.currPageSize=t,this.pageReset=!0,this.updateTableData(1,1)},setDefaultDimensionsAndMetrics:function(){var t=JSON.stringify(this.defaultDimensions);this.currDimensions=JSON.parse(t),this.syncDimensions=JSON.parse(t),t=JSON.stringify(this.knownMetrics),this.metrics=JSON.parse(t),this.currMetrics=JSON.parse(t),this.syncMetrics=JSON.parse(t)},updateTableData:function(t,e){var a=this;this.tableLoading=!0;var r=this.wrapTableReqParams(t,e);this.getAbroadCohortTableData(r).then((function(t){a.tableLoading=!1})).catch((function(t){a.tableLoading=!1,a.showError(t)}))},updateTotalData:function(){var t=this,e=this.wrapTotalReqParams();e.group_by&&this.getAbroadCohortTotalData(e).then((function(t){})).catch((function(e){return t.showError(e)}))},updatePageData:function(t){var e=this;this.tableLoading=!0,this.chartLoading=!0,Promise.all([this.getAbroadCohortTableData(this.wrapTableReqParams(t)),this.getAbroadCohortTotalData(this.wrapTotalReqParams())]).then((function(t){e.inited=!0,e.tableLoading=!1,e.chartLoading=!1})).catch((function(t){e.tableLoading=!1,e.chartLoading=!1,e.showError(t)}))},downloadFile:function(){var t=this;this.downloadLoading=!0;var e=this.wrapDownloadReqParams();e.pageRooter="abroadCohort",this.getAbroadCohortDownloadUrl(e).then((function(e){t.downloadLoading=!1;var a=document.createElement("a");a.href=e.url,a.click()})).catch((function(e){t.downloadLoading=!1,t.showError(e)}))},wrapTableReqParams:function(t,e){var a={time_range:Object(u["r"])(this.currFilterApply),page:JSON.stringify({count:2===t||1===e?1:this.currPageIndex,size:this.currPageSize}),filtering:Object(u["m"])(this.currFilterApply,this.inFields,this.likeFields),group_by:Object(u["n"])(this.currDimensions),fields:Object(u["l"])(this.knownMetrics),sort:Object(u["p"])(this.currSortField,t,this.currDimensions,this.currDimensionsLength),show_type:this.currCohort,statistic_type:this.cohortType,calculate_by:this.calculateBy};return a},wrapTotalReqParams:function(){var t={time_range:Object(u["r"])(this.currFilterApply),filtering:Object(u["m"])(this.currFilterApply,this.inFields,this.likeFields),fields:Object(u["l"])(this.knownMetrics),show_type:this.currCohort,statistic_type:this.cohortType,calculate_by:this.calculateBy,query_type:"summary"};return t},wrapDownloadReqParams:function(){var t=this.currDownloadParams.basic_metrics,e=this.currDownloadParams.core_metrics,a={time_range:Object(u["r"])(this.currFilterApply),filtering:Object(u["m"])(this.currFilterApply,this.inFields,this.likeFields),group_by:Object(u["n"])(this.currDownloadParams.dimensions,!0),fields:Object(u["l"])(t),show_type:Object(u["l"])(e),statistic_type:this.currDownloadParams.cohortType,calculate_by:this.currDownloadParams.calculate_by,file_format:this.currDownloadParams.fileFormat};return a},showError:function(t){this.$Modal.error({title:"Error",content:t})},pageResetFalse:function(){this.pageReset=!1},onSelectPageInfo:function(t){var e=JSON.parse(t);this.$refs.pageFilter.setFilter(e.filter),this.currCohort=e.currCohort,this.cohortType=e.cohortType,this.calculateBy=e.calculateBy,this.$refs.table.$refs.childTableDimensions.setData(e.dimensions),this.currDimensions=JSON.parse(JSON.stringify(e.dimensions.dimensions.length>0?e.dimensions.dimensions:this.knownDimensions)),this.metrics=JSON.parse(JSON.stringify(e.dimensions.metrics.length>0?e.dimensions.metrics:this.knownMetrics)),e.filter.time_type&&(e.filter.rangeDates=Object(c["f"])(e.filter.time_type)),this.showRule(),this.onFilterApply(e.filter)},onGetPageInfo:function(t){var e=this.$refs.pageFilter.getFilter(),a=this.$refs.table.$refs.childTableDimensions.getData(),r=JSON.stringify({filter:e,currCohort:this.currCohort,calculateBy:this.calculateBy,cohortType:this.cohortType,dimensions:a});d["a"].$emit("setPageInfo",t,r)}}),mounted:function(){this.setDefaultDimensionsAndMetrics(),this.updatePageData();var t=this;d["a"].$on("selectPageInfo",(function(e){t.onSelectPageInfo(e)})),d["a"].$on("getPageInfo",(function(e){t.onGetPageInfo(e)}))},beforeDestroy:function(){d["a"].$off("selectPageInfo"),d["a"].$off("getPageInfo")}},f=y,m=(a("9a7d"),a("2877")),b=Object(m["a"])(f,r,i,!1,null,"2306f4c2",null);e["default"]=b.exports}}]);