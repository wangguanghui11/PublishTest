(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0aa5d6"],{1166:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Card",[a("fruit-console-tables",{ref:"tables",attrs:{stripe:"",editable:"",searchable:"",batchDelete:!1,"search-place":"top",topadd:e.topAdd,selectData:[{key:"app_name",value:e.canSelectApp},{key:"ad_type",value:e.canSelectAdType}],columns:e.columns,loading:e.loading},on:{"on-edit":e.handleEdit,"on-add":e.handleAdd,"on-delete":e.handleDelete,"on-batch-delete":e.handleBatchDelete,"on-selection-change":e.handleSelectionChange},model:{value:e.allPlacementGroup,callback:function(t){e.allPlacementGroup=t},expression:"allPlacementGroup"}}),a("Modal",{attrs:{"footer-hide":!0,width:450},model:{value:e.showDragDrawer,callback:function(t){e.showDragDrawer=t},expression:"showDragDrawer"}},[a("div",{staticStyle:{"margin-right":"30px"}},[a("placement-group-form",{attrs:{"row-event":e.rowEvent,"form-model":e.placementGroup,"all-app":e.allApp,"all-ad-type":e.allAdType,"all-placement":e.allPlacement,"all-placement-group":e.allPlacementGroup,"form-show":e.showDragDrawer},on:{"on-submit":e.handleSubmit}})],1)])],1)],1)},l=[],r=(a("8e6e"),a("456d"),a("ac6a"),a("5df3"),a("28a5"),a("7f7f"),a("ade3")),o=a("cd9b"),p=a("7d75"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"border-bottom":"1px solid #e8eaec","padding-top":"1px","padding-right":"16px","padding-bottom":"14px","padding-left":"16px","line-height":"1","margin-bottom":"16px","font-size":"14px"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"add"===e.rowEvent.name?"ios-add":"ios-create",size:18}}),a("b",[e._v(" "+e._s("add"===e.rowEvent.name?"Add placement group":"Update placement group"))])],1),a("Form",{ref:"formx",attrs:{model:e.formModel,rules:e.ruleValidate,"label-width":130}},[a("FormItem",{attrs:{label:"App name",prop:"app_id"}},[a("Select",{attrs:{placeholder:"Select app",filterable:"",disabled:"add"!==e.rowEvent.name},on:{"on-change":e.handleAppChange},model:{value:e.formModel.app_id,callback:function(t){e.$set(e.formModel,"app_id",t)},expression:"formModel.app_id"}},e._l(e.allApp,(function(t){return a("Option",{key:t.app_id,attrs:{value:t.app_id}},[e._v(e._s(t.app_name))])})),1)],1),a("FormItem",{attrs:{label:"Ad type",prop:"ad_type"}},[a("Select",{attrs:{placeholder:"Select ad type",filterable:"",disabled:"add"!==e.rowEvent.name},on:{"on-change":e.handleAdTypeChange},model:{value:e.formModel.ad_type,callback:function(t){e.$set(e.formModel,"ad_type",t)},expression:"formModel.ad_type"}},e._l(e.allAdType,(function(t,n){return a("Option",{key:n,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("FormItem",{attrs:{label:"Placement Group Name",prop:"placement_group_name"}},[a("Input",{attrs:{placeholder:"Enter placement group name"},model:{value:e.formModel.placement_group_name,callback:function(t){e.$set(e.formModel,"placement_group_name",t)},expression:"formModel.placement_group_name"}})],1),a("FormItem",{attrs:{label:"Placement Group",prop:"placement_group"}},[a("Select",{attrs:{multiple:"",placeholder:"Select placement",filterable:""},model:{value:e.formModel.placement_group,callback:function(t){e.$set(e.formModel,"placement_group",t)},expression:"formModel.placement_group"}},e._l(e.canSelectPlacements,(function(t){return a("Option",{key:t.app_placement_id,attrs:{value:t.app_placement_id}},[e._v(e._s(t.app_placement_name))])})),1)],1),a("FormItem",{staticStyle:{"margin-bottom":"5px"}},[a("Button",{staticStyle:{float:"right","margin-left":"8px"},attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("formx")}}},[e._v("Submit")]),a("Button",{staticStyle:{float:"right"},on:{click:function(t){return e.handleReset("formx")}}},[e._v("Reset")])],1)],1)],1)},i=[],d=(a("4f7f"),{name:"placement-group-form",props:{rowEvent:{type:Object,default:function(){return{name:"add",placement_group_id:""}}},formModel:{type:Object,default:function(){return{app_id:"",ad_type:"",placement_group_id:"",placement_group_name:"",placement_group:[]}}},allApp:{type:Array,default:function(){return[]}},allAdType:{type:Array,default:function(){return[]}},allPlacement:{type:Array,default:function(){return[]}},allPlacementGroup:{type:Array,default:function(){return[]}},formShow:{type:Boolean,default:!1}},data:function(){return{ruleValidate:{app_id:[{required:!0,message:"Please select the app",trigger:"change"}],ad_type:[{required:!0,message:"Please select the ad type",trigger:"change"}],placement_group_name:[{required:!0,message:"The placement group name cannot be empty",trigger:"blur"}],placement_group:[{required:!0,type:"array",message:"The placement group list cannot be empty"}]}}},methods:{handleSubmit:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var a=t.illegalForm(t.formModel.app_id,t.formModel.ad_type,t.formModel.placement_group,t.formModel.placement_group_id);!0===a?t.$Modal.error({title:"Error",content:"The combination of App, Ad type and PlacementGroup is illegal!"}):t.$emit("on-submit",t.formModel)}}))},handleReset:function(e){this.$refs[e].resetFields(),this.formModel.placement_group=[]},disablePlacement:function(e){var t=this.formModel.app_id,a=e.app_id!==t||e.app_ads_type!==this.formModel.ad_type;return!0===a?a:this.inOther(e.app_placement_id,t,this.formModel.placement_group_id)},inOther:function(e,t,a){if(this.allPlacementGroup&&this.allPlacementGroup.length>0)for(var n=0;n<this.allPlacementGroup.length;n++){var l=this.allPlacementGroup[n];if((!a||null==a||""===a||a!==l.placement_group_id)&&(l.app_id===t&&l.placement_group&&l.placement_group.length>0)){var r=new Set(l.placement_group);if(!0===r.has(e))return!0}}return!1},illegalForm:function(e,t,a,n){for(var l=this.getPlacementsByIds(a),r=0;r<l.length;r++)if(l[r].app_id!==e||l[r].app_ads_type!==t)return!0;for(var o=0;o<a.length;o++){var p=this.inOther(a[o],e,n);if(!0===p)return!0}},getPlacementsByIds:function(e){var t=new Set(e);return this.allPlacement.filter((function(e){return t.has(e.app_placement_id)}))},handleAppChange:function(){this.formModel.placement_group=[]},handleAdTypeChange:function(){this.formModel.placement_group=[]}},computed:{showAdd:function(){return"add"===this.rowEvent.name&&!0===this.formShow},canSelectPlacements:function(){var e=this;return this.allPlacement.filter((function(t){return!e.disablePlacement(t)}))}},watch:{showAdd:function(e,t){!0===e&&this.handleReset("formx")}}}),u=d,s=a("2877"),m=Object(s["a"])(u,c,i,!1,null,null,null),h=m.exports,f=a("2f62");function _(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_(Object(a),!0).forEach((function(t){Object(r["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var y={name:"placement-group",components:{FruitConsoleTables:o["a"],DragDrawer:p["a"],PlacementGroupForm:h},data:function(){var e=this;return{initData:!1,topAdd:!0,rowEvent:{name:"",placement_group_id:""},columns:[{title:"序号",key:"id",width:60,render:function(e,t){var a=t?t.index+1:"-";return e("div",a)}},{title:"App-Name",key:"app_name",searchable:!0,isSelect:!0},{title:"Ad-Type",key:"ad_type",searchable:!0,isSelect:!0},{title:"Placement-Group-Name",key:"placement_group_name",searchable:!0,width:180},{title:"Placement-Group",key:"placement_group",render:function(t,a){for(var n=a.row.placement_group,l=[],r=function(a){var r=e.allPlacement.filter((function(e){return e.app_placement_id===n[a]}))[0].app_placement_name;l.push(t("Button",{props:{type:"success",ghost:!0,size:"small"}},[t("Icon",{props:{type:"md-pin",size:16,color:"#FF0000"}}),t("span",r)]))},o=0;o<n.length;o++)r(o);return t("div",l)}},{title:"Last-updated-date",key:"last_updated_date"},{title:"Operator",key:"operator"},{title:"Handle",key:"handle",options:["edit","delete"]}],showDragDrawer:!1,width1:350,placement:!1,draggable:!0,placementGroup:{},selectedRows:[],canSelectApp:[],canSelectAdType:[],loading:!0}},methods:g(g({},Object(f["b"])(["getAllApp","getAllNetworkAdType","getAllPlacementGroup","postPlacementGroup","putPlacementGroup","deletePlacementGroup","batchDeletePlacementGroup","getALLAppPlacement"])),{},{handleAdd:function(){this.rowEvent={name:"add",placement_group_id:""}},handleEdit:function(e){this.rowEvent={name:"edit",placement_group_id:e.row.placement_group_id}},handleDelete:function(e){var t=this;this.deletePlacementGroup(e.row).then((function(e){t.$Message.success("Delete Success!")})).catch((function(e){t.$Modal.error({title:"Error",content:e})}))},handleSubmit:function(e){var t=this;if("add"===this.rowEvent.name)this.postPlacementGroup(e).then((function(e){t.hideForm(),t.$Message.success("Add Success!")})).catch((function(e){t.$Modal.error({title:"Error",content:e})}));else if("edit"===this.rowEvent.name){var a=this.getPlacementGroup(this.rowEvent.placement_group_id),n=Object.assign({},e,{placement_group_id:a.placement_group_id});this.putPlacementGroup(n).then((function(e){t.hideForm(),t.$Message.success("Update Success!")})).catch((function(e){t.$Modal.error({title:"Error",content:e})}))}},getPlacementGroup:function(e){return this.allPlacementGroup.filter((function(t){return t.placement_group_id===e}))[0]},handleSelectionChange:function(e){this.selectedRows=e},handleBatchDelete:function(){var e=this;if(this.selectedRows.length>0){var t=this;this.$Modal.confirm({title:"warning",content:"Are you sure to delete the selected?",onOk:function(){t.batchDeletePlacementGroup(e.selectedRows).then((function(e){t.$Message.success("Batch delete Success!")})).catch((function(e){t.$Message.error(e)}))},onCancel:function(){}})}else this.$Modal.info({title:"Info",content:"You have not chosen"})},showForm:function(){this.showDragDrawer=!0},hideForm:function(){this.showDragDrawer=!1}}),computed:g({placementComputed:function(){return this.placement?"left":"right"}},Object(f["d"])({allApp:function(e){return e.app_setting.allApp},allAdType:function(e){return e.network_ad_type.allNetworkAdType},allPlacement:function(e){return e.app_placement.allAppPlacement},allPlacementGroup:function(e){if(!0===this.initData)return e.placement_group.allPlacementGroup.map((function(t){return t.app_name=e.app_setting.allApp.filter((function(e){return e.app_id===t.app_id}))[0].app_name,t.state=!0,t.last_updated_date=t.updated_at.split(".")[0],t}))}})),watch:{rowEvent:{deep:!0,handler:function(e,t){if("add"===e.name)this.placementGroup={app_id:"",ad_type:"",placement_group_id:"",placement_group_name:""},this.showForm();else if("edit"===e.name){var a=this.getPlacementGroup(e.placement_group_id);this.placementGroup={app_id:a.app_id,ad_type:a.ad_type,placement_group_id:a.placement_group_id,placement_group_name:a.placement_group_name,placement_group:a.placement_group},this.showForm()}}}},mounted:function(){var e=this;this.getAllApp().then((function(t){var a=t;e.canSelectApp=a.map((function(e){return e.app_name})),Promise.all([e.getAllNetworkAdType(),e.getALLAppPlacement({apps:a}),e.getAllPlacementGroup(a)]).then((function(t){e.canSelectAdType=t[0],e.initData=!0,e.loading=!1}))}))}},b=y,v=Object(s["a"])(b,n,l,!1,null,null,null);t["default"]=v.exports}}]);