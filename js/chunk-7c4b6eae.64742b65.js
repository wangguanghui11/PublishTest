(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7c4b6eae"],{"1f50":function(t,e,a){"use strict";a("598c")},"55b7":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",[a("page-filter",{ref:"pageFilter",attrs:{loading:t.tableLoading},on:{"on-filter-apply":t.onFilterApply}})],1),a("div",{attrs:{id:"mainItem"}},[a("Row",{staticClass:"contentsItem"},[a("Card",{attrs:{shadow:""}},[a("div",{staticClass:"checkBoxItemRightAbsolute",staticStyle:{position:"absolute"}},[a("Checkbox",{staticStyle:{"font-size":"14px","margin-right":"40px"},on:{"on-change":t.changeCheckbox},model:{value:t.checkStatus,callback:function(e){t.checkStatus=e},expression:"checkStatus"}},[t._v("显示数字标签")]),t.visible?a("a",{on:{click:t.previewFun}},[t._v("点击预览")]):t._e(),a("Tooltip",{attrs:{content:"关闭预览"}},[a("Button",{attrs:{id:"closeBtn"},on:{click:t.closeFun}},[t._v("X")])],1)],1),a("tabs-list-mixture",{ref:"tabsList",attrs:{"page-rooter":"profitLoss1","tab-pane-data":t.tabPaneData,"field-formaters":t.field_formaters,"known-fields":t.profit_fields,"line-chart-data":t.lineChartData,"check-status":t.checkStatus,"preview-status":t.previewStatus},on:{"on-tab-refresh":t.selectTab}},[a("template",{slot:"refresh"},[a("div",{staticStyle:{width:"100%",height:"auto",overflow:"hidden"}},[a("chart-group",{ref:"chartGroup",attrs:{"select-mode":"default","known-fields":t.profit_fields,"all-chart-groups":t.chartGroups,"default-chart-groups":t.defaultChartGroups},on:{"on-chart-group-change":t.handleChartGroupChange,"on-chart-group-refresh":t.handleChartGroupRefresh}})],1)])],2)],1),t.chartLoading?a("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)],1),a("Row",{staticStyle:{"margin-top":"5px"}},[a("Card",{attrs:{shadow:""}},[a("div",{staticStyle:{"margin-left":"0%","margin-bottom":"10px",color:"#3B3B3B","font-size":"12px"}},[t._v(t._s(t.ChartDes))]),a("table-data",{ref:"table",attrs:{data:t.tableData,cur_sys_name:t.cur_sys_name,"table-loading":t.tableLoading,days:t.days,"all-app":t.allApp,"footer-data":t.totalData,"page-reset":t.pageReset,"page-data":t.pageData,"field-formaters":t.field_formaters,"known-fields":t.profit_fields,dimensions:t.currDimensions,metrics:t.metrics,"default-dimensions":t.defaultDimensions,"all-dimensions":t.allDimensions,"all-metrics":t.allMetrics,"sync-dimensions":t.syncDimensions,"sync-metrics":t.syncMetrics,"page-rooter":"profitLoss"},on:{"on-click-cell":t.onClickCell,"on-sort-change":t.handleSortChange,"metrics-ok":t.metricsOk,"on-table-refresh":t.handleTableRefresh,"on-download":t.download,"on-page-change":t.pageChange,"on-page-size-change":t.pageSizeChange,"on-page-reset-true":t.pageResetFalse,"on-dimensions-change":t.handleDimensionsChange}})],1),t.downloadLoading?a("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)],1)},n=[],i=(a("8e6e"),a("55dd"),a("456d"),a("c5f6"),a("2909")),s=(a("5df3"),a("ac6a"),a("20d6"),a("28a5"),a("ade3")),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{ref:"filter",staticClass:"filter-selection"},[a("div",[a("a-select",{staticClass:"inline-width",staticStyle:{"font-size":"12px"},attrs:{mode:"multiple",allowClear:"",filterable:"",showArrow:"",autoClearSearchValue:!1,"max-tag-count":this.maxTagArr[0],"max-tag-text-length":this.maxTagTextArr[0],placeholder:"项目组-全部",optionFilterProp:"children"},on:{focus:function(e){return t.focusFun(0)},blur:function(e){return t.blurFun()},mouseenter:function(e){return t.mouseenterFun(0)},mouseleave:function(e){return t.mouseleaveFun()},change:t.projectsChange},scopedSlots:t._u([{key:"dropdownRender",fn:function(e){return a("div",{},[a("v-nodes",{attrs:{vnodes:e}}),a("a-divider",{staticClass:"select-all-divider"}),a("div",{staticClass:"select-all-div",on:{mousedown:function(t){return t.preventDefault()}}},[a("span",{staticClass:"select-all-span"},[t._v(t._s(t.projects.length)+"/"+t._s(t.allProjects.length))]),a("Button",{attrs:{type:"primary"},on:{click:function(e){t.projects=t.allProjects}}},[t._v("全选")])],1)],1)}}]),model:{value:t.projects,callback:function(e){t.projects=e},expression:"projects"}},t._l(t.allProjects,(function(e){return a("Option",{key:e,attrs:{value:e}},[t._v(t._s(e)+"\n      ")])})),1),a("a-select",{staticClass:"inline-width",staticStyle:{"font-size":"12px"},attrs:{mode:"multiple",allowClear:"",filterable:"",showArrow:"",autoClearSearchValue:!1,"max-tag-count":this.maxTagArr[1],"max-tag-text-length":this.maxTagTextArr[1],placeholder:"App-全部",optionFilterProp:"children"},on:{focus:function(e){return t.focusFun(2)},blur:function(e){return t.blurFun()},mouseenter:function(e){return t.mouseenterFun(1)},mouseleave:function(e){return t.mouseleaveFun()}},scopedSlots:t._u([{key:"dropdownRender",fn:function(e){return a("div",{},[a("v-nodes",{attrs:{vnodes:e}}),a("a-divider",{staticClass:"select-all-divider"}),a("div",{staticClass:"select-all-div",on:{mousedown:function(t){return t.preventDefault()}}},[a("span",{staticClass:"select-all-span"},[t._v(t._s(t.apps.length)+"/"+t._s(t.canSelectAllApp.length))]),a("Button",{attrs:{type:"primary"},on:{click:function(e){t.apps=t.canSelectAllApp.map((function(t){return t.app_id}))}}},[t._v("全选")])],1)],1)}}]),model:{value:t.apps,callback:function(e){t.apps=e},expression:"apps"}},t._l(t.canSelectAllApp,(function(e){return a("Option",{key:e.app_id,attrs:{value:e.app_id}},[t._v(t._s(e.app_name)+"\n      ")])})),1),a("a-select",{staticClass:"inline-width",staticStyle:{"font-size":"12px"},attrs:{mode:"multiple",allowClear:"",filterable:"",showArrow:"",autoClearSearchValue:!1,"max-tag-count":this.maxTagArr[3],"max-tag-text-length":this.maxTagTextArr[3],placeholder:"国家-全部",optionFilterProp:"children"},on:{focus:function(e){return t.focusFun(3)},blur:function(e){return t.blurFun()},mouseenter:function(e){return t.mouseenterFun(2)},mouseleave:function(e){return t.mouseleaveFun()}},scopedSlots:t._u([{key:"dropdownRender",fn:function(e){return a("div",{},[a("v-nodes",{attrs:{vnodes:e}}),a("a-divider",{staticClass:"select-all-divider"}),a("div",{staticClass:"select-all-div",on:{mousedown:function(t){return t.preventDefault()}}},[a("span",{staticClass:"select-all-span"},[t._v(t._s(t.countries.length)+"/"+t._s(t.allCountries.length))]),a("Button",{attrs:{type:"primary"},on:{click:function(e){t.countries=t.allCountries.map((function(t){return t.country_id}))}}},[t._v("全选")])],1)],1)}}]),model:{value:t.countries,callback:function(e){t.countries=e},expression:"countries"}},t._l(t.allCountries,(function(e){return a("Option",{key:e.country_id,attrs:{value:e.country_id}},[t._v(t._s(e.country_name+"("+e.country_id+")")+"\n      ")])})),1),a("DatePicker",{staticClass:"inline-width",attrs:{type:"daterange",options:t.daterangeoption,clearable:!1,placement:"bottom-start",placeholder:"选择日期范围"},model:{value:t.rangeDates,callback:function(e){t.rangeDates=e},expression:"rangeDates"}}),a("Button",{attrs:{type:"primary",disabled:t.loading},on:{click:t.handleSubmit}},[t._v("Apply Filter")])],1),a("div",{staticClass:"optionsContents",attrs:{id:"optionsContent"}},t._l(t.tmpOptions,(function(e){return a("li",{key:e},[t._v(t._s(e))])})),0)])},l=[],c=(a("4f7f"),a("2f62")),u=a("90de"),p=a("9839"),h=a("4b65"),f=(a("1ef0"),a("1157")),d=a.n(f);function g(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function m(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?g(Object(a),!0).forEach((function(e){Object(s["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):g(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var y={name:"page-filter",components:{ASelect:p["d"],Option:p["d"].Option,VNodes:{functional:!0,render:function(t,e){return e.props.vnodes}}},data:function(){return{projects:[],apps:[],countries:["US"],appTypes:[],allProjects:[],canSelectAllAppType:[],canSelectAllApp:[],allApp:[],allCountries:[],allAppTypes:[],daterangeoption:{},rangeDates:[],maxTagArr:[1,1,1,1,1],maxTagTextArr:[20,20,20,20,20],tmpAllOptions:[],tmpOptions:[],mark:0}},props:{loading:{type:Boolean,default:function(){return!1}}},methods:m(m({},Object(c["b"])(["getAllProject","getAllAppForDashboard","getAllAppType","getAllCountry"])),{},{handleSubmit:function(t){var e={projects:this.projects,apps:this.apps,countries:this.countries,appTypes:this.appTypes,rangeDates:this.rangeDates};this.$emit("on-filter-apply",e)},filterAppAndAppType:function(t,e){this.filterApp(t,e),this.filterAppType(t)},filterAppType:function(t){if(this.canSelectAllAppType=[].concat(this.allAppTypes),t.length>0){for(var e=[],a=0;a<this.canSelectAllApp.length;a++)e.push(this.canSelectAllApp[a].app_type);var r=new Set(e);this.canSelectAllAppType=this.canSelectAllAppType.filter((function(t){return r.has(t.id)})),this.appTypes=this.appTypes.filter((function(t){return r.has(t)}))}},filterApp:function(t,e){if(this.canSelectAllApp=[].concat(this.allApp),t&&t.length>0){this.apps=[];var a=new Set(t);this.canSelectAllApp=this.canSelectAllApp.filter((function(t){return a.has(t.project)}))}if(e&&e.length>0){this.apps=[];var r=new Set(e);this.canSelectAllApp=this.canSelectAllApp.filter((function(t){return r.has(t.app_type)}))}},projectsChange:function(t){this.appTypes=[],this.filterAppAndAppType(t,this.appTypes)},appTypeChange:function(t){this.filterApp(this.projects,t)},maxTagCountfun:function(t){return this.maxTagCountObj&&this.maxTagCountObj[t]?this.maxTagCountObj[t]:1},focusFun:function(t){this.mark=1,d()("#optionsContent").length&&d()("#optionsContent").css({display:"none"}),this.maxTagArr=[1,1,1,1,1],this.maxTagTextArr=[20,20,20,20,20];var e=this;setTimeout((function(){e.maxTagArr.splice(t,0,10),e.maxTagTextArr.splice(t,0,100)}),500)},blurFun:function(){this.mark=0,this.maxTagArr.findIndex((function(t){return 10===t}))>=0&&(this.maxTagArr=[1,1,1,1,1],this.maxTagTextArr=[20,20,20,20,20]),this.setItemValues()},mouseenterFun:function(t){if(1!==this.mark){this.tmpOptions=this.tmpAllOptions[t];var e=Object(h["g"])(this.$refs["filter"].$el.clientWidth,t),a=document.getElementById("optionsContent");d()("#optionsContent").length&&this.tmpOptions&&this.tmpOptions.length>0&&a&&(d()("#optionsContent").css({display:"block",left:e.left+"px"}),a.style.setProperty("top",e.top+"px","important"))}},mouseleaveFun:function(){this.hideContentItem(),this.setItemValues()},setItemValues:function(){var t=this;this.tmpAllOptions[0]=this.projects;var e=[];this.apps&&this.apps.map((function(a,r){t.canSelectAllApp&&t.canSelectAllApp.map((function(t,r){a===t.app_id&&e.push(t.app_name)}))})),this.tmpAllOptions[1]=e;var a=[];this.countries&&this.countries.map((function(e,r){t.allCountries&&t.allCountries.map((function(t,r){e===t.country_id&&a.push(t.country_name+"("+e+")")}))})),this.tmpAllOptions[2]=a},getFilter:function(){return{projects:this.projects,apps:this.apps,countries:this.countries,appTypes:this.appTypes,rangeDates:[Object(h["c"])(this.rangeDates[0]),Object(h["c"])(this.rangeDates[1])],time_type:Object(h["i"])(this.rangeDates)}},setFilter:function(t){this.projects=t.projects,this.apps=t.apps,this.countries=t.countries,this.appTypes=t.appTypes,this.rangeDates=t.rangeDates,t.time_type&&(this.rangeDates=Object(u["f"])(t.time_type))},hideContentItem:function(){d()("#optionsContent").length&&d()("#optionsContent").css({display:"none"})}}),mounted:function(){var t=this;this.daterangeoption=Object(u["b"])(),Promise.all([this.getAllProject(),this.getAllAppType(),this.getAllCountry(),this.getAllAppForDashboard("aso_country")]).then((function(e){t.allAppTypes=e[1],t.allCountries=e[2],t.allApp=e[3],t.canSelectAllApp=[].concat(t.allApp),t.canSelectAllAppType=[].concat(t.allAppTypes),t.allProjects=e[0].filter((function(e){return t.allApp.findIndex((function(t){return t.project===e}))>=0}))}))},created:function(){this.rangeDates=Object(u["f"])("country_dimension")}},b=y,_=(a("8413"),a("2877")),v=Object(_["a"])(b,o,l,!1,null,"3bcd7fe3",null),D=v.exports,A=a("3dd2"),C=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",["profitLoss"===t.pageRooter?a("RadioGroup",{staticClass:"radioWapper",model:{value:t.tabItem,callback:function(e){t.tabItem=e},expression:"tabItem"}},t._l(t.tabPaneData,(function(e,r){return a("Radio",{key:r,staticStyle:{"margin-top":"10px","margin-bottom":"10px"},attrs:{label:e.label}},[t._v(t._s(e.value))])})),1):t._e(),"profitLoss"===t.pageRooter?a("Divider"):t._e(),a("Tabs",{class:["profitLoss"===t.pageRooter?"hideTabItem":"tabItems"],attrs:{animated:!1},on:{"on-click":t.selectTab},model:{value:t.tabItem,callback:function(e){t.tabItem=e},expression:"tabItem"}},t._l(t.tabPaneData,(function(e,r){return a("TabPane",{key:r,attrs:{label:e.value,name:e.label}},[1==e.showGroup?t._t("refresh"):t._e(),e.label===t.tabItem&&0===e.chartType?a("group-line-chart",{ref:"child",refInFor:!0,attrs:{"field-formaters":t.fieldFormaters,"known-fields":t.knownFields,"chart-data":t.lineChartData[r],status:t.checkStatus,previewStatus:t.previewStatus,"money-type":t.moneyType,"inverse-status":!0}}):t._e(),e.label===t.tabItem&&1===e.chartType?a("group-mixture-chart",{ref:"child",refInFor:!0,attrs:{"field-formaters":t.fieldFormaters,"known-fields":t.knownFields,"chart-data":t.lineChartData[r],status:t.checkStatus,previewStatus:t.previewStatus,"money-type":t.moneyType}}):t._e()],2)})),1)],1)},O=[],x=a("88e6"),S=a("7ba5"),w={name:"tabs-list-mixture",components:{GroupLineChart:x["a"],GroupMixtureChart:S["a"]},props:{tabValue:{type:String,default:function(){return"name1"}},pageRooter:{type:String,default:function(){return""}},fieldFormaters:{type:Object,default:function(){return{}}},knownFields:{type:Array,default:function(){return[]}},lineChartData:{type:Array,default:function(){return[]}},tabPaneData:{type:Array,default:function(){return[]}},checkStatus:{type:Boolean,default:function(){return!1}},previewStatus:{type:Boolean,default:function(){return!1}},moneyType:{type:String,default:function(){return null}}},data:function(){return{tabItem:"name1"}},methods:{selectTab:function(t){this.$emit("on-tab-refresh",t)}}},T=w,k=(a("b66e"),Object(_["a"])(T,C,O,!1,null,null,null)),F=k.exports,j=a("bdcb"),P=(a("ca62"),a("4481"));function I(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function G(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?I(Object(a),!0).forEach((function(e){Object(s["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):I(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var R={name:"profit-loss",components:{ChartGroup:A["a"],PageFilter:D,TabsListMixture:F,TableData:j["a"]},data:function(){return{ChartDes:"*只有dimensions已选项中同时包含日期、AppName、国家，表格中才会展示榜单排名以及推荐位。",cur_sys_name:"country_dimensionality",showGroupBy:!0,inited:!1,rowGutter:20,filteredCountry:!1,tabPaneData:[{label:"name1",value:"AF organ占比",chartType:1,showGroup:1},{label:"name2",value:"GP转化率",chartType:1,showGroup:1},{label:"name3",value:"下载榜单排名(Game榜单)",chartType:0,showGroup:0},{label:"name4",value:"下载榜单排名(分类榜单)",chartType:0,showGroup:0}],chartFields:["af_ratio","gp_ratio","game_free_rank","sort_free_rank"],chartGroups:["app_name","country"],defaultChartGroups:["app_name"],defaultDimensions:["app_name","country","date"],knownDimensions:["year","year_quarterly","year_month","date","project","app_name","app_type","country"],inFields:[["projects","project"],["apps","app_id"],["countries","country"],["appTypes","app_type"]],knownMetrics:["organ_install","non_organ_install","total_install","rate","store_listing_visitors","store_listing_acquisitions","store_listing_rate","game_free_rank","sort_type","sort_free_rank","title_path"],metrics:[],currFilterApply:{countries:["US"]},currSortField:{},currDimensions:[],currMetrics:[],currDownloadParams:{},currPageIndex:1,currPageSize:100,currChartGroups:[],currChartGroups3:[],currChartGroups4:[],curTabName:"name1",lineChartData:[],pageReset:!1,tableLoading:!0,chartLoading:!0,downloadLoading:!1,syncDimensions:[],syncMetrics:[],checkStatus:!1,previewStatus:!1,visible:!0}},computed:G(G({},Object(c["d"])({field_formaters:function(t){return t.dashboard_field.field_formaters},profit_fields:function(t){return t.dashboard_field.profit_fields},allApp:function(t){return t.app_reporting.allApp},tableData:function(t){if(!0===this.inited)return t.country_dimensionalyty.coutryAll.data},totalData:function(t){if(!0===this.inited){var e=t.country_dimensionalyty.profitLossTotalData.data;if(e&&e.length>0)return e[0]}},pageData:function(t){if(!0===this.inited){var e=t.country_dimensionalyty.coutryAll,a={page_size:e.page_size,has_next:e.has_next,has_prev:e.has_prev,total_num:e.total_num};return a}}})),{},{allDimensions:function(){return Object(h["j"])(this.profit_fields,this.knownDimensions)},allMetrics:function(){return Object(h["j"])(this.profit_fields,this.knownMetrics)},days:function(){var t=Object(h["h"])(this.currFilterApply,"country_dimension");return t}}),methods:G(G({},Object(c["b"])(["getASOCountryData","getDimensionChartData","dowloadDimensionExcel","getCountryTableAll","getASOCountryTotalData","getCountryTableTotalAll"])),{},{onFilterApply:function(t){this.currFilterApply=JSON.parse(JSON.stringify(t)),this.currSortField={},this.currDimensions=JSON.parse(JSON.stringify(this.currDimensions)),this.currFilterApply.countries&&this.currFilterApply.countries.length>0?this.filteredCountry=!0:this.filteredCountry=!1,this.currPageIndex=1,this.pageReset=!0,this.updatePageData(1)},handleSortChange:function(t,e,a){this.currPageIndex=1,this.currSortField={key:t.key,order:t.order},this.pageReset=!0,this.updateTableData(2)},handleTableRefresh:function(t,e){if(this.currDimensions=JSON.parse(JSON.stringify(t)),0===this.currDimensions.length){this.currDimensionsLength=0;var a=JSON.stringify(this.knownDimensions);this.currDimensions=JSON.parse(a)}else this.currDimensionsLength=1;if(this.currMetrics=e,this.currSortField={},this.currMetrics=e,this.metrics=e,0===this.currMetrics.length){var r=JSON.stringify(this.knownMetrics);this.currMetrics=JSON.parse(r),this.metrics=JSON.parse(r)}this.currPageIndex=1,this.updateTableData(1),this.updateTotalData(),this.pageReset=!0},handleDimensionsChange:function(t){this.syncDimensions=JSON.parse(JSON.stringify(t))},metricsOk:function(t){this.currMetrics=t,this.metrics=t,this.syncMetrics=JSON.parse(JSON.stringify(t)),this.metrics.length<=0&&(this.metrics=JSON.parse(JSON.stringify(this.knownMetrics)),this.syncMetrics=JSON.parse(JSON.stringify(this.knownMetrics)))},download:function(t){this.currDownloadParams=JSON.parse(JSON.stringify(t)),this.downloadFile()},pageChange:function(t){this.currPageIndex=t,this.updateTableData(1)},pageSizeChange:function(t){this.currPageSize=t,this.pageReset=!0,this.updateTableData(1,1)},onClickCell:function(t,e){var a=this;"title_path"===e&&(t.column.render=function(r,n){if(n.index===t.index)return r("span",n.row[e]);var i=n.row[e];return null!=i&&(i=i.split("\n")[0]+(i.split("\n").length>1?"...":"")),r("span",{style:{color:"#1890FF",cursor:"pointer"},on:{click:function(){a.onClickCell(n,e)}}},i)})},showError:function(t){this.$Modal.error({title:"Error",content:t})},pageResetFalse:function(){this.pageReset=!1},changeCheckbox:function(t){this.checkStatus=t,this.lineChartData.status=t},onSelectPageInfo:function(t){var e=JSON.parse(t);this.$refs.pageFilter.setFilter(e.filter),this.$refs.chartGroup.chartGroups=e.chart_group,this.currChartGroups=e.chart_group,this.$refs.tabsList.tabItem=e.cur_chart,this.checkStatus=e.checkStatus,this.$refs.table.$refs.childTableDimensions.setData(e.dimensions),this.currDimensions=JSON.parse(JSON.stringify(e.dimensions.dimensions.length>0?e.dimensions.dimensions:this.knownDimensions)),this.metrics=JSON.parse(JSON.stringify(e.dimensions.metrics.length>0?e.dimensions.metrics:this.knownMetrics)),e.filter.time_type&&(e.filter.rangeDates=Object(u["f"])(e.filter.time_type)),this.onFilterApply(e.filter)},onGetPageInfo:function(t){var e=this.$refs.pageFilter.getFilter(),a=this.currChartGroups,r=this.$refs.tabsList.tabItem,n=this.$refs.table.$refs.childTableDimensions.getData(),i=JSON.stringify({filter:e,chart_group:a,cur_chart:r,checkStatus:this.checkStatus,dimensions:n});P["a"].$emit("setPageInfo",t,i)},previewFun:function(){var t=document.getElementsByClassName("checkBoxItemRightAbsolute")[0];t.style.position="static",this.visible=!1,this.previewStatus=!0,t.style.position="absolute";var e=document.getElementsByClassName("contentsItem");this.$nextTick((function(){if(d()("#mainItem").length&&d()("#closeBtn").length&&e){var t=document.body.clientWidth;d()("#mainItem").css({width:t+"px",height:"100vh",background:"rgba(0,0,0,.8)",position:"fixed",top:"0",left:"0",zIndex:"1000"}),d()("#closeBtn").css({position:"fixed",top:"10%",right:"0",zIndex:"1000",marginTop:"12px",marginRight:"12px",display:"block"}),e[0].style.top="8%"}}))},closeFun:function(){this.visible=!0,this.previewStatus=!1,d()("#mainItem").length&&d()("#closeBtn").length&&(d()("#mainItem").css({width:"auto",height:"auto",position:"static",background:"#ffffff"}),d()("#closeBtn").css({display:"none"}))},wrapChartReqParams:function(t){0===this.currChartGroups.length&&(this.currChartGroups=this.defaultChartGroups),0===this.currChartGroups3.length&&(this.currChartGroups3=this.defaultChartGroups),0===this.currChartGroups4.length&&(this.currChartGroups4=this.defaultChartGroups);var e=JSON.stringify(["date"]);"game_free_rank"!==t&&"sort_free_rank"!==t||(e=JSON.stringify(["app_name","date","country"])),"af_ratio"===t&&this.currChartGroups3.findIndex((function(t){return"total"===t}))<0&&(e=JSON.stringify(this.currChartGroups3.concat(["date"]))),"gp_ratio"===t&&this.currChartGroups4.findIndex((function(t){return"total"===t}))<0&&(e=JSON.stringify(this.currChartGroups4.concat(["date"])));var a={time_range:Object(h["r"])(this.currFilterApply,"country_dimension"),group_by:e,filtering:Object(h["m"])(this.currFilterApply,this.inFields),fields:Object(h["l"])(this.chartFields)};return a},wrapTableReqParams:function(t,e){var a=[];this.currDimensions.forEach((function(t,e){var r={field:t,order:"ascending"};a.push(r)}));var r={time_range:Object(h["r"])(this.currFilterApply,"country_dimension"),page:JSON.stringify({count:2===t||1===e?1:this.currPageIndex,size:this.currPageSize}),filtering:Object(h["m"])(this.currFilterApply,this.inFields),group_by:Object(h["n"])(this.currDimensions),fields:Object(h["l"])(this.knownMetrics),multi_sort:Object(h["q"])(this.currSortField,t,a,this.currDimensionsLength)};return r},wrapTotalReqParams:function(){var t={time_range:Object(h["r"])(this.currFilterApply,"country_dimension"),filtering:Object(h["m"])(this.currFilterApply,this.inFields),fields:Object(h["l"])(this.knownMetrics)};return t},updatePageData:function(t){var e=this;this.chartLoading=!0,this.tableLoading=!0;var a=this.wrapChartReqParams("game_free_rank"),r=this.wrapChartReqParams("sort_free_rank"),n=this.wrapChartReqParams("af_ratio"),i=this.wrapChartReqParams("gp_ratio"),s=this.wrapTableReqParams(t);Promise.all([this.getASOCountryData(G(G({},a),{},{type:"game_free_rank"})),this.getASOCountryData(G(G({},r),{},{type:"sort_free_rank"})),this.getASOCountryData(G(G({},n),{},{type:"af_ratio"})),this.getASOCountryData(G(G({},i),{},{type:"gp_ratio"})),this.getCountryTableAll(s),this.getCountryTableTotalAll(this.wrapTotalReqParams())]).then((function(t){e.inited=!0,e.tableLoading=!1,e.chartLoading=!1,e.getLineChartData()})).catch((function(t){e.tableLoading=!1,e.chartLoading=!1,e.showError(t)}))},handleLineData:function(t){if(t){var e=!0;return t.values.forEach((function(t,a){t.forEach((function(t,a){if(t)return e=!1,e}))})),e}},getLineChartData:function(){var t,e,a=[],r=[],n=[],s=[],o=[],l={},c={},u=["game_free_rank"],p=["sort_free_rank"],f=["organ_install","non_organ_install","rate"],d=["store_listing_rate","store_listing_acquisitions","store_diffence"],g={rate:{chartType:"line",multiply:100,yAxisIndex:1},organ_install:{chartType:"bar",color:"#4D72BE",multiply:1,yAxisIndex:0},non_organ_install:{chartType:"bar",color:"#7EAA55",multiply:1,yAxisIndex:0},store_listing_rate:{chartType:"line",multiply:100,yAxisIndex:1},store_listing_acquisitions:{chartType:"bar",color:"#5470C6",multiply:1,yAxisIndex:0},store_diffence:{chartType:"bar",color:"#D7D7D7",multiply:1,yAxisIndex:0}};if(!0===this.inited&&(this.currChartGroups=["app_name","country"],r=Object(h["t"])(this.$store.state.country_dimensionalyty.asoGameRank.data,u,this.currChartGroups),n=Object(h["t"])(this.$store.state.country_dimensionalyty.asoSortRank.data,p,this.currChartGroups),s=Object(h["t"])(this.$store.state.country_dimensionalyty.asoAFRatio.data,f,this.currChartGroups3),o=Object(h["t"])(this.$store.state.country_dimensionalyty.asoGPRatio.data,d,this.currChartGroups4),r&&this.handleLineData(r[0])&&(r[0].xAxisData=[]),n&&this.handleLineData(n[0])&&(n[0].xAxisData=[])),r)for(var m=0;m<r.length;m++)for(var y=r[m].legendData.length-1;y>=0;y--)"/"!==r[m].legendData[y]&&""!==r[m].legendData[y]||(r[m].legendData.splice(y,1),r[m].values.splice(y,1));if(n)for(var b=0;b<n.length;b++)for(var _=n[b].legendData.length-1;_>=0;_--)"/"!==n[b].legendData[_]&&""!==n[b].legendData[_]||(n[b].legendData.splice(_,1),n[b].values.splice(_,1));if(s)for(var v=0;v<s.length;v++){for(var D=s[v].legendData.length-1;D>=0;D--)"/"!==s[v].legendData[D]&&""!==s[v].legendData[D]||(s[v].legendData.splice(D,1),s[v].values.splice(D,1));var A=s[v].values.some((function(t,e){return t.some((function(t,e){return t}))}));0!==s[v].legendData.length&&A||(s[v].values=[],s[v].xAxisData=[])}if(o)for(var C=0;C<o.length;C++){for(var O=o[C].legendData.length-1;O>=0;O--)"/"!==o[C].legendData[O]&&""!==o[C].legendData[O]||(o[C].legendData.splice(O,1),o[C].values.splice(O,1));var x=o[C].values.some((function(t,e){return t.some((function(t,e){return t}))}));0!==o[C].legendData.length&&x||(o[C].values=[],o[C].xAxisData=[])}var S=[],w=[];if(s&&s.length>0){for(var T=[],k=function(t){for(var e=g[s[t].chartField],a=s[t],r=function(r){for(var n={},i=a.values[r],o=0;o<i.length;o++)i[o]&&("bar"===e.chartType&&(i[o]=Number(i[o].toFixed(2))),"line"===e.chartType&&(i[o]=100*parseFloat(i[o].toFixed(4))),0===i[o]&&(i[o]=null));var l=[];a.values[r].forEach((function(e){l.push({label:s[t].legendData[r],value:e})})),n.data=l,n.type=e.chartType,n.emphasis={focus:"series"},n.yAxisIndex=e.yAxisIndex?e.yAxisIndex:0,"bar"===e.chartType&&(n.stack="".concat(s[0].legendData.indexOf(s[t].legendData[r])),n.itemColor=e.color,n.name=s[t].chartField,n.z=100),"line"===e.chartType&&(n.name="".concat(s[t].legendData[r]),n.name2=s[t].legendData[r],n.z=1e4),T.push(n)},n=0;n<a.values.length;n++)r(n);"bar"===e.chartType&&S.push(s[t].chartField)},F=0;F<s.length;F++)k(F);s[2].legendData.map((function(t){w.push("".concat(t))})),s[0]&&(l.chartField=this.chartFields[2],l.childFieldsOther=f,l.groups=Object(i["a"])(s[0].groups),l.legendData1=S,l.legendData2=w,l.xAxisData=Object(i["a"])(s[0].xAxisData),l.values=T,l.ChartDes="AF organ占比")}var j=[],P=[];if(o&&o.length>0){for(var I=[],G=function(t){for(var e=g[o[t].chartField],a=o[t],r=function(r){for(var n={},i=a.values[r],s=0;s<i.length;s++)if(i[s]){if("bar"===e.chartType&&(i[s]=Number(i[s])),"line"===e.chartType){var l=i[s].toFixed(4),c=parseFloat(l);i[s]=100*c}0===i[s]&&(i[s]=null)}var u=[];a.values[r].forEach((function(e){u.push({label:o[t].legendData[r],value:e})})),n.data=u,n.type=e.chartType,n.emphasis={focus:"series"},n.yAxisIndex=e.yAxisIndex?e.yAxisIndex:0,"bar"===e.chartType&&(n.stack="".concat(o[0].legendData.indexOf(o[t].legendData[r])),n.itemColor=e.color,"store_diffence"===o[t].chartField&&(n.name="GP未获取用户",n.textColor="#5470C6"),"store_listing_acquisitions"===o[t].chartField&&(n.name="GP获取用户"),n.z=100),"line"===e.chartType&&(n.name="".concat(o[t].legendData[r]),n.z=1e4),I.push(n)},n=0;n<o[t].values.length;n++)r(n);"bar"===e.chartType&&("store_diffence"===o[t].chartField&&j.push("GP未获取用户"),"store_listing_acquisitions"===o[t].chartField&&j.push("GP获取用户"))},R=0;R<o.length;R++)G(R);o[0].legendData.map((function(t){P.push("".concat(t))})),o[0]&&(c.chartField=this.chartFields[3],c.childFieldsOther=d,c.groups=Object(i["a"])(o[0].groups),c.legendData1=j,c.legendData2=P,c.xAxisData=Object(i["a"])(o[0].xAxisData),c.values=I,c.ChartDes="GP转化率")}if(r&&0!==Object.keys(r).length||(r=[{chartField:this.chartFields[0],legendData:[],xAxisData:[],values:[]}]),n&&0!==Object.keys(n).length||(n=[{chartField:this.chartFields[1],legendData:[],xAxisData:[],values:[]}]),l&&0!==Object.keys(l).length||(l={chartField:this.chartFields[2],legendData1:[],legendData2:[],xAxisData:[],values:[],ChartDes:"AF organ占比"}),c&&0!==Object.keys(c).length||(c={chartField:this.chartFields[3],legendData1:[],legendData2:[],xAxisData:[],values:[],ChartDes:"GP转化率"}),r.forEach((function(t){t.grid={left:"2.8%"}})),n.forEach((function(t){t.grid={left:"2.8%"}})),this.changeBarDataStack(l),this.changeBarDataStack(c),a.push(l),a.push(c),(t=a).push.apply(t,Object(i["a"])(r)),(e=a).push.apply(e,Object(i["a"])(n)),!this.inited){a=[];for(var N=0;N<this.chartFields.length;N++)a.push({chartField:this.chartFields[N],legendData:[],xAxisData:[],values:[]})}this.lineChartData=a},changeBarDataStack:function(t){var e={};t.values.forEach((function(t,a){if("bar"===t.type){Object.hasOwnProperty.call(e,t.stack)&&(e[t.stack]=0);var r=1e5;t.data.forEach((function(t,e){r-=t.value})),e[t.stack]+=r}}));var a=[];for(var r in e)a.push({value:e[r],key:r});a.sort((function(t,e){return t.value-e.value})),t.values.forEach((function(t,e){if(t.stack)for(var r=0;r<a.length;r++)if(t.stack===a[r].key){t.stack="".concat(r);break}}))},updateChartData:function(){var t=this;this.chartLoading=!0;var e=this.wrapChartReqParams();this.getDimensionChartData(e).then((function(e){t.chartLoading=!1})).catch((function(e){t.chartLoading=!1,t.showError(e)}))},handleChartGroupChange:function(t){"name1"===this.curTabName&&(this.currChartGroups3=t),"name2"===this.curTabName&&(this.currChartGroups4=t)},handleChartGroupRefresh:function(){var t=this;this.chartLoading=!0;var e=this.wrapChartReqParams("game_free_rank"),a=this.wrapChartReqParams("sort_free_rank"),r=this.wrapChartReqParams("af_ratio"),n=this.wrapChartReqParams("gp_ratio");Promise.all([this.getASOCountryData(G(G({},e),{},{type:"game_free_rank"})),this.getASOCountryData(G(G({},a),{},{type:"sort_free_rank"})),this.getASOCountryData(G(G({},r),{},{type:"af_ratio"})),this.getASOCountryData(G(G({},n),{},{type:"gp_ratio"}))]).then((function(e){t.chartLoading=!1,t.getLineChartData()})).catch((function(e){t.chartLoading=!1,t.showError(e)}))},selectTab:function(t){this.curTabName=t},updateTableData:function(t,e){var a=this;this.tableLoading=!0;var r=this.wrapTableReqParams(t,e);this.getCountryTableAll(r).then((function(t){a.tableLoading=!1})).catch((function(t){a.tableLoading=!1,a.showError(t)}))},updateTotalData:function(){var t=this,e=this.wrapTotalReqParams();this.getCountryTableTotalAll(e).then((function(t){})).catch((function(e){return t.showError(e)}))},wrapDownloadReqParams:function(){var t=[];this.currDownloadParams.dimensions.forEach((function(e,a){var r={field:e,order:"ascending"};t.push(r)}));var e={time_range:Object(h["r"])(this.currFilterApply,"country_dimension"),filtering:Object(h["m"])(this.currFilterApply,this.inFields),group_by:Object(h["n"])(this.currDownloadParams.dimensions,!0),fields:Object(h["l"])(this.currDownloadParams.metrics),file_format:this.currDownloadParams.fileFormat,pageRooter:"countryDimensionality",multi_sort:t};return e},downloadFile:function(){var t=this;this.downloadLoading=!0;var e=this.wrapDownloadReqParams();this.dowloadDimensionExcel(e).then((function(e){t.downloadLoading=!1;var a=document.createElement("a");a.href=e.url,a.click()})).catch((function(e){t.downloadLoading=!1,t.showError(e)}))},setDefaultDimensionsAndMetrics:function(){var t=JSON.stringify(this.defaultDimensions);this.currDimensions=JSON.parse(t),this.syncDimensions=JSON.parse(t),t=JSON.stringify(this.knownMetrics),this.metrics=JSON.parse(t),this.currMetrics=JSON.parse(t),this.syncMetrics=JSON.parse(t)}}),mounted:function(){this.setDefaultDimensionsAndMetrics(),this.updatePageData();var t=this;P["a"].$on("selectPageInfo",(function(e){t.onSelectPageInfo(e)})),P["a"].$on("getPageInfo",(function(e){t.onGetPageInfo(e)}))},beforeDestroy:function(){P["a"].$off("selectPageInfo"),P["a"].$off("getPageInfo")}},N=R,L=(a("1f50"),Object(_["a"])(N,r,n,!1,null,"4c9b9ec4",null));e["default"]=L.exports},"598c":function(t,e,a){},"6d04":function(t,e,a){},"7e0e":function(t,e,a){},8413:function(t,e,a){"use strict";a("7e0e")},b66e:function(t,e,a){"use strict";a("6d04")}}]);