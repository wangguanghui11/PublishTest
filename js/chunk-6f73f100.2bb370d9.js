(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f73f100"],{"0c19":function(e,t,n){"use strict";n("fe9a")},"751a":function(e,t,n){},c57e:function(e,t,n){"use strict";n("751a")},e869:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{position:"relative"}},[e.loading?n("Spin",{attrs:{size:"large",fix:""}}):e._e(),n("Card",{staticStyle:{"margin-bottom":"12px"}},[n("Button",{attrs:{type:"primary"},on:{click:e.handleCreateFunnel}},[e._v("Create Table")])],1),e.status?n("div",{staticStyle:{"min-height":"500px"}},[n("Row",{staticStyle:{"margin-top":"5px"}},[n("page-filter",{ref:"pageFilter",on:{"on-filter-apply":e.filterApply}})],1),n("Row",{staticStyle:{"margin-top":"5px"}},[n("Card",{attrs:{shadow:""}},[n("table-data",{ref:"table",staticClass:"event_table event_info_table",attrs:{data:e.mainTableData,"table-loading":e.tableLoading,"page-reset":e.mainPageReset,"page-data":e.mainPageData,"field-formaters":e.field_formaters,"known-fields":e.event_info_list,dimensions:e.mainKnownDimensions,metrics:e.mainKnownMetrics,"default-dimensions":e.mainKnownDimensions,"have-index":!0,"have-dimension":!1,"have-total":!1,"page-rooter":"eventInfoList"},on:{"on-delete":e.handleDelete,"on-sort-change":e.mainHandleSortChange,"on-page-change":e.mainPageChange,"on-page-size-change":e.mainPageSizeChange,"on-page-reset-true":e.mainPageResetFalse,"on-click-cell":e.onClickCell}})],1)],1)],1):n("div",[n("Card",[n("p",{staticStyle:{"line-height":"50vh","text-align":"center"}},[e._v("请先创建报表！")])])],1)],1)},i=[],r=(n("8e6e"),n("456d"),n("7f7f"),n("ac6a"),n("5df3"),n("ade3")),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Card",{ref:"filter",staticClass:"filter-selection"},[n("div",[n("a-select",{staticClass:"inline-width",staticStyle:{"font-size":"12px"},attrs:{mode:"multiple",allowClear:"",filterable:"",showArrow:"",autoClearSearchValue:!1,"max-tag-count":this.maxTagArr[0],"max-tag-text-length":this.maxTagTextArr[0],placeholder:"App-全部",optionFilterProp:"children"},on:{focus:function(t){return e.focusFun(0)},blur:function(t){return e.blurFun()},mouseenter:function(t){return e.mouseenterFun(0)},mouseleave:function(t){return e.mouseleaveFun()}},scopedSlots:e._u([{key:"dropdownRender",fn:function(t){return n("div",{},[n("v-nodes",{attrs:{vnodes:t}}),n("a-divider",{staticClass:"select-all-divider"}),n("div",{staticClass:"select-all-div",on:{mousedown:function(e){return e.preventDefault()}}},[n("span",{staticClass:"select-all-span"},[e._v(e._s(e.apps.length)+"/"+e._s(e.canSelectAllApp.length))]),n("Button",{attrs:{type:"primary"},on:{click:function(t){e.apps=e.canSelectAllApp.map((function(e){return e.app_id}))}}},[e._v("全选")])],1)],1)}}]),model:{value:e.apps,callback:function(t){e.apps=t},expression:"apps"}},e._l(e.canSelectAllApp,(function(t){return n("Option",{key:t.app_id,attrs:{value:t.app_id}},[e._v(e._s(t.app_name)+"\n      ")])})),1),n("Input",{staticStyle:{width:"280px","margin-right":"2px","margin-bottom":"3px"},attrs:{placeholder:"input table name",clearable:""},model:{value:e.table_name,callback:function(t){e.table_name=t},expression:"table_name"}}),n("Input",{staticStyle:{width:"280px","margin-right":"2px","margin-bottom":"3px"},attrs:{placeholder:"input creator",clearable:""},model:{value:e.create_by,callback:function(t){e.create_by=t},expression:"create_by"}}),n("Button",{staticStyle:{"margin-bottom":"3px"},attrs:{type:"primary",disabled:e.loading},on:{click:e.handleSubmit}},[e._v("Apply Filter")])],1),n("div",{staticClass:"optionsContents",attrs:{id:"optionsContent"}},e._l(e.tmpOptions,(function(t){return n("li",{key:t},[e._v(e._s(t))])})),0)])},s=[],l=(n("55dd"),n("20d6"),n("2f62")),c=n("9839"),p=(n("1ef0"),n("4b65")),u=n("1157"),f=n.n(u),m=n("c276");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g={name:"page-info-filter",components:{ASelect:c["d"],Option:c["d"].Option,VNodes:{functional:!0,render:function(e,t){return t.props.vnodes}}},data:function(){return{apps:[],allApp:[],canSelectAllApp:[],table_name:"",create_by:"",maxTagArr:[1,1,1,1],maxTagTextArr:[20,20,20,20],tmpAllOptions:[],tmpOptions:[],mark:0}},props:{loading:{type:Boolean,default:function(){return!1}}},methods:d(d({},Object(l["b"])(["getAllAppOfEventList"])),{},{initAllSelect:function(){this.canSelectAllApp=this.allApp.filter((function(e){return null!=e}))},handleSubmit:function(e){var t={apps:this.apps,table_name:this.table_name,create_by:this.create_by,like:"LIKE"};this.$emit("on-filter-apply",t)},maxTagCountfun:function(e){return this.maxTagCountObj&&this.maxTagCountObj[e]?this.maxTagCountObj[e]:1},focusFun:function(e){this.mark=1,f()("#optionsContent").length&&f()("#optionsContent").css({display:"none"}),this.maxTagArr=[1,1,1,1],this.maxTagTextArr=[20,20,20,20];var t=this;setTimeout((function(){t.maxTagArr.splice(e,0,10),t.maxTagTextArr.splice(e,0,100)}),500)},blurFun:function(){this.mark=0,this.maxTagArr.findIndex((function(e){return 10===e}))>=0&&(this.maxTagArr=[1,1,1,1],this.maxTagTextArr=[20,20,20,20]),this.setItemValues()},mouseenterFun:function(e){if(1!==this.mark){this.tmpOptions=this.tmpAllOptions[e];var t=Object(p["g"])(this.$refs["filter"].$el.clientWidth,e),n=document.getElementById("optionsContent");f()("#optionsContent").length&&this.tmpOptions&&this.tmpOptions.length>0&&n&&(f()("#optionsContent").css({display:"block",left:t.left+"px"}),n.style.setProperty("top",t.top+"px","important"))}},mouseleaveFun:function(){this.hideContentItem(),this.setItemValues()},setItemValues:function(){var e=this,t=[];this.apps&&this.apps.map((function(n,a){e.canSelectAllApp&&e.canSelectAllApp.map((function(e,a){n===e.app_id&&t.push(e.app_name)}))})),this.tmpAllOptions[0]=t},getFilter:function(){return{apps:this.apps,table_name:this.table_name,create_by:this.create_by,like:"LIKE"}},setFilter:function(e){this.apps=e.apps,this.table_name=e.table_name,this.create_by=e.create_by},hideContentItem:function(){var e=document.getElementById("optionsContent");e&&(e.style.display="none")}}),mounted:function(){var e=this;if(Object(m["k"])("eventInfo-search-params")&&"{}"!==Object(m["k"])("eventInfo-search-params")){var t=JSON.parse(Object(m["k"])("eventInfo-search-params"));this.apps=t.apps,this.table_name=t.table_name,this.create_by=t.create_by,setTimeout((function(){localStorage.removeItem("eventInfo-search-params")}),100)}Promise.all([this.getAllAppOfEventList()]).then((function(t){var n=[];n=t[0].filter((function(e){return""!==e&&null!==e&&"null"!==e})),n=n.sort((function(e,t){return e.app_name.localeCompare(t.app_name,"zh-CN")})),e.allApp=n,e.initAllSelect()}))}},b=g,v=(n("c57e"),n("2877")),_=Object(v["a"])(b,o,s,!1,null,"1b56b9b2",null),y=_.exports,O=n("bdcb"),C=n("4481");function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){Object(r["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A={name:"event-info-list",components:{PageFilter:y,TableData:O["a"]},data:function(){return{status:!1,loading:!1,tableLoading:!1,mainInited:!1,mainInFields:[["projects","project"],["apps","app_id"]],mainLikeFields:[["table_name","like","table_name"],["create_by","like","create_by"]],mainCurrSortField:{},mainKnownDimensions:["app_name","table_name"],mainKnownMetrics:["events","description","create_by","update_time","update_by","handle_delete"],mainCurrFilterApply:{},mainCurrPageIndex:1,mainCurrPageSize:100,mainPageReset:!1}},computed:P({},Object(l["d"])({field_formaters:function(e){return e.dashboard_field.field_formaters},event_info_list:function(e){return e.dashboard_field.event_info_list},mainTableData:function(e){if(!0===this.mainInited)return e.event_info_list.allEventInfoTableData.data},mainPageData:function(e){if(!0===this.mainInited){var t=e.event_info_list.allEventInfoTableData,n={page_size:t.page_size,has_next:t.has_next,has_prev:t.has_prev,total_num:t.total_num};return n}}})),methods:P(P({},Object(l["b"])(["getEventInfoLists","deleteEventInfoData","getAllAppOfEventList"])),{},{filterApply:function(e){this.mainCurrPageIndex=1,this.mainPageReset=!0,this.mainCurrFilterApply=JSON.parse(JSON.stringify(e)),this.mainCurrSortField={},localStorage.removeItem("eventInfo-search-params"),this.getData(2)},mainWrapTableReqParams:function(e){Object(m["k"])("eventInfo-search-params")&&"{}"!==Object(m["k"])("eventInfo-search-params")&&(this.mainCurrFilterApply=JSON.parse(Object(m["k"])("eventInfo-search-params")));var t={page:JSON.stringify({count:e&&1===e?1:this.mainCurrPageIndex,size:this.mainCurrPageSize}),filtering:Object(p["m"])(this.mainCurrFilterApply,this.mainInFields,this.mainLikeFields),sort:Object(p["p"])(this.mainCurrSortField)};return t},handleDelete:function(e){var t=this,n='<div style="word-break: break-all"><strong>确定删除: </strong>"'+e.row.table_name+'"吗？<br/>';n+="<strong>Event Name: </strong>"+e.row.events+"<br/>",e.row.description&&(n+="<strong>Description: </strong>"+e.row.description+"<br/>"),this.$Modal.confirm({title:"删除报表",content:n,onOk:function(){Promise.all([t.deleteEventInfoData({id:e.row.id})]).then((function(e){t.$Message.success("删除成功!"),t.mainCurrPageIndex=1,t.mainPageReset=!0,t.getData(1)})).catch((function(e){t.$Modal.error({title:"Error",content:e.message})}))}})},mainHandleSortChange:function(e,t,n){this.mainCurrPageIndex=1,this.mainCurrSortField={key:e.key,order:e.order},this.mainPageReset=!0,this.getData(1)},mainPageChange:function(e){this.mainCurrPageIndex=e,this.getData(2)},mainPageSizeChange:function(e){this.mainCurrPageSize=e,this.mainPageReset=!0,this.getData(1)},mainPageResetFalse:function(){this.mainPageReset=!1},setSaveSearch:function(){Object(m["l"])("eventInfo-search-params",JSON.stringify(this.mainCurrFilterApply))},handleCreateFunnel:function(){this.setSaveSearch(),this.$router.push({name:"event_info_detail",params:{}})},onClickCell:function(e){this.setSaveSearch(),this.$router.push({name:"event_info_detail",query:{id:e.row.id}})},getData:function(e){var t=this;e?this.tableLoading=!0:this.loading=!0;var n=this.mainWrapTableReqParams(e);this.getEventInfoLists(n).then((function(e){t.mainInited=!0,t.tableLoading=!1,t.loading=!1})).catch((function(e){t.tableLoading=!1,t.loading=!1,t.showError(e)}))},getEventInfoApp:function(){var e=this;this.getAllAppOfEventList().then((function(t){t&&t.length>0?e.status=!0:e.status=!1}))},onSelectPageInfo:function(e){var t=JSON.parse(e);this.$refs.pageFilter.setFilter(t.filter),this.filterApply(t.filter)},onGetPageInfo:function(e){var t=this.$refs.pageFilter.getFilter(),n=JSON.stringify({filter:t});C["a"].$emit("setPageInfo",e,n)}}),mounted:function(){this.getData(),this.getEventInfoApp(),history.pushState(null,null,document.URL),window.addEventListener("popstate",(function(){history.pushState(null,null,document.URL)}));var e=this;C["a"].$on("selectPageInfo",(function(t){e.onSelectPageInfo(t)})),C["a"].$on("getPageInfo",(function(t){e.onGetPageInfo(t)}))},beforeDestroy:function(){C["a"].$off("selectPageInfo"),C["a"].$off("getPageInfo")},beforeCreate:function(){var e=this.$route.name;"event_info_detail"!==e&&"event_info_list"!==e&&localStorage.removeItem("eventInfo-search-params")}},I=A,x=(n("0c19"),Object(v["a"])(I,a,i,!1,null,null,null));t["default"]=x.exports},fe9a:function(e,t,n){}}]);