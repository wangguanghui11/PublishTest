(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-63c79194"],{"33a8":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Row",[n("page-filter",{ref:"pageFilter",attrs:{loading:t.tableLoading,pageAeo:!0},on:{"on-filter-apply":t.onFilterApply}})],1),n("Row",{staticStyle:{"margin-top":"5px"}},[n("Card",{attrs:{shadow:""}},[n("RadioGroup",{staticClass:"radioWapper",on:{"on-change":t.handleCohortChange},model:{value:t.currCohort,callback:function(e){t.currCohort=e},expression:"currCohort"}},t._l(t.allCohorts,(function(e,i){return n("Radio",{key:40+i,staticStyle:{"margin-top":"10px","margin-bottom":"10px"},attrs:{label:e.val}},[t._v(t._s(e.label))])})),1),n("Divider"),n("div",[n("span",{directives:[{name:"show",rawName:"v-show",value:t.showCalculateBy,expression:"showCalculateBy"}],staticStyle:{"margin-right":"10px"}},[t._v("by")]),n("Select",{directives:[{name:"show",rawName:"v-show",value:t.showCalculateBy,expression:"showCalculateBy"}],staticStyle:{width:"140px"},on:{"on-change":t.handleCalculateByChange},model:{value:t.calculateBy,callback:function(e){t.calculateBy=e},expression:"calculateBy"}},t._l(t.knownCalculateByArr,(function(e,i){return n("Option",{key:i,attrs:{value:e.val}},[t._v(t._s(e.label))])})),1),n("RadioGroup",{staticStyle:{"margin-left":"10px"},attrs:{type:"button"},on:{"on-change":t.handleCohoreTypeChange},model:{value:t.cohortType,callback:function(e){t.cohortType=e},expression:"cohortType"}},[n("Radio",{attrs:{label:"grand_total",disabled:t.disableTotal}},[t._v("累计")]),n("Radio",{attrs:{label:"on_the_day",disabled:t.disableDay}},[t._v("当日")])],1)],1),n("Divider"),n("multi-title-table",{ref:"table",attrs:{data:t.tableData,"footer-data":t.totalData,"table-loading":t.tableLoading,"known-fields":t.aeo_cohort,"table-height":600,"dynamic-height":!0,formater:t.field_formaters,"day-range":t.dayRange,"curr-cohort":t.currCohort,"cohort-type":t.cohortType,"all-dimensions":t.allDimensions,"all-metrics":t.allMetrics,"default-dimensions":t.defaultDimensions,"default-title-dimensions":t.defaultTitleDimensions,"default-metrics":t.defaultMetrics},on:{"on-table-refresh":t.handleTableRefresh,"on-dimensions-or-metrics-refresh":t.handleDimensionsOrMetricsRefresh}})],1)],1)],1)},a=[],r=(n("8e6e"),n("456d"),n("ac6a"),n("5df3"),n("ade3")),s=n("0df7"),l=n("8b2b"),o=n("bdcb"),c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticStyle:{"margin-bottom":"5px"}},[n("span",[t._v("行:")]),n("a-select",{staticClass:"inline-width",attrs:{mode:"multiple",allowClear:"",showArrow:"","max-tag-count":1,placeholder:"请选择",optionFilterProp:"children",disabled:t.isLoading()},on:{change:t.handleDimensionsOrMetricsRefresh},model:{value:t.dimensions,callback:function(e){t.dimensions=e},expression:"dimensions"}},t._l(t.allDimensions,(function(e,i){return n("Option",{key:i,attrs:{value:e.val,disabled:t.disabledDimension(e)}},[t._v(t._s(e.label))])})),1),n("span",{staticStyle:{"margin-left":"10px"}},[t._v("列:")]),n("a-select",{staticClass:"inline-width",attrs:{mode:"multiple",allowClear:"",showArrow:"","max-tag-count":1,placeholder:"请选择",optionFilterProp:"children",disabled:t.isLoading()},on:{change:t.handleDimensionsOrMetricsRefresh},model:{value:t.titleDimensions,callback:function(e){t.titleDimensions=e},expression:"titleDimensions"}},t._l(t.allDimensions,(function(e,i){return n("Option",{key:i,attrs:{value:e.val,disabled:t.disabledTitleDimension(e)}},[t._v(t._s(e.label))])})),1),n("span",{staticStyle:{"margin-left":"10px"}},[t._v("值:")]),n("a-select",{staticClass:"inline-width",attrs:{mode:"multiple",allowClear:"",showArrow:"","max-tag-count":1,placeholder:"请选择",optionFilterProp:"children",disabled:t.isLoading()},on:{change:t.handleDimensionsOrMetricsRefresh},model:{value:t.metrics,callback:function(e){t.metrics=e},expression:"metrics"}},t._l(t.canSelectMetrics,(function(e,i){return n("Option",{key:i,attrs:{value:e.val}},[t._v(t._s(e.label))])})),1),n("Button",{staticStyle:{"margin-left":"10px","margin-bottom":"3px"},attrs:{type:"primary",disabled:t.isLoading()},on:{click:t.handleRefresh}},[t._v("刷新")]),n("Button",{staticStyle:{float:"right","margin-bottom":"3px"},attrs:{type:"primary",disabled:t.isLoading()},on:{click:t.handleDownload}},[t._v("下载")]),n("Poptip",{staticStyle:{float:"right","margin-right":"5px","margin-top":"3px"},attrs:{placement:"top",transfer:!0,width:"100","word-wrap":"",trigger:"hover"}},[n("div",{staticStyle:{"word-break":"break-all"},attrs:{slot:"content"},slot:"content"},[t._v("请先刷新再下载")]),n("Icon",{staticStyle:{display:"inline-block"},attrs:{type:"ios-help-circle-outline",size:18,color:"#2d8cf0"}})],1)],1),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showTable(),expression:"showTable()"}],staticClass:"localTableDiv"},[n("Row",[n("Table",{ref:"table",staticClass:"topTable",attrs:{data:t.tableData,columns:t.tableColumns,loading:t.isLoading(),border:"",height:t.height},on:{"on-sort-change":t.handleSortChange}}),t.noSummery?t._e():n("Table",{ref:"total",staticClass:"summeryTable",attrs:{data:t.totalData,columns:t.tableColumns,loading:t.isLoading(),border:"","show-header":!1,height:"58"},on:{"on-sort-change":t.handleSortChange}})],1),t.noPage?t._e():n("Row",{staticStyle:{"text-align":"center"}},[n("Page",{ref:"tablePages",attrs:{"page-size":50,total:t.allTableData.length,current:1,"page-size-opts":t.pageSizeOpts,"show-sizer":"","show-total":"","show-elevator":""}})],1)],1),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.showTable(),expression:"!showTable()"}],staticStyle:{"text-align":"center"}},[n("span",{staticStyle:{"font-size":"15px"}},[t._v("暂无数据")])])])},u=[],h=(n("ac4d"),n("8a81"),n("1c4c"),n("7f7f"),n("6b54"),n("20d6"),n("55dd"),n("c5f6"),n("90de")),d=(n("a481"),n("4b65")),f=n("6612"),p=n.n(f);function y(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=m(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){l=!0,r=t},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw r}}}}function m(t,e){if(t){if("string"===typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var b=function(t,e,n,i,a){var r,s=[],l=y(i);try{var o=function(){var i,l=r.value,o={},c=y(e);try{for(c.s();!(i=c.n()).done;){var u=i.value;o[u]=l[u]}}catch(w){c.e(w)}finally{c.f()}var h=s.findIndex((function(t){var n,i=y(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(t[a]!==o[a])return!1}}catch(w){i.e(w)}finally{i.f()}return!0}));h<0?s.push(o):o=s[h];var d,f="",p=y(t);try{for(p.s();!(d=p.n()).done;){var m=d.value;f+=l[m]}}catch(w){p.e(w)}finally{p.f()}var g,b=y(n);try{for(b.s();!(g=b.n()).done;){var v=g.value;o[f+v]=l[v],"retention"===a&&null!=l[v]&&(o["retention_users_"+f+v]=l["retention_users_"+v])}}catch(w){b.e(w)}finally{b.f()}};for(l.s();!(r=l.n()).done;)o()}catch(c){l.e(c)}finally{l.f()}return s},v=function(t,e,n,i,a,r,s,l,o,c){var u=Object(d["e"])(i),h=[];l&&h.push({fixed:"left",title:"序号",type:"index",width:60});var f,p=null,m=null,g=0,b=y(t);try{for(b.s();!(f=b.n()).done;){var v=f.value;g<u.get(v).width&&(g=u.get(v).width);var _={};_.title=u.get(v).label,_.fixed="left",_.align="center",_.children=[],v===t[0]?m=_:p.children.push(_),p=_}}catch(nt){b.e(nt)}finally{b.f()}var O,C=y(a.values());try{for(C.s();!(O=C.n()).done;){var S=O.value,T=u.get(S),k="",N=150;T&&null!==T&&(k=T.label,N=T.width,1===a.length&&N<g&&(N=g)),k&&null!==k&&""!==k||(k=S);var x={title:k,key:S,fixed:"left",tooltip:!0,width:N,sortable:"custom"};T.nosort&&(x.sortable=!1),null==p?h.push(x):p.children.push(x)}}catch(nt){C.e(nt)}finally{C.f()}0===a.length&&null!=p&&p.children.push({title:" ",key:"total",fixed:"left",width:"100"}),m&&h.push(m);var A,j=w(t,e,n),M=!0,P=y(j);try{for(P.s();!(A=P.n()).done;){var B=A.value;if(M=!M,0===r.length){for(var J="",R={title:" ",width:"120"},I=B.length-1;I>=0;--I){J=B[I].value+J;var L={title:B[I].value?B[I].value:" ",width:"120",key:J};M||(L.className="blue-table-info-column"),null==R||(L.children=[R]),R=L}h.push(R)}var F,$=y(r);try{for($.s();!(F=$.n()).done;){var E=F.value,z=u.get(E),H=D(E,z,s,c,o);M||(H.className="blue-table-info-column");for(var q={},U=null,G="",W=0;W<B.length;++W){G+=B[W].value;var V={title:B[W].value?B[W].value:" ",children:[]};if(M||(V.className="blue-table-info-column"),U=V.children,0===W)q=V;else{for(var K=q.children,Q=1;Q<W;++Q)K=K[0].children;K.push(V),U=K[0].children}}H.key=G+H.key,U.push(H),h.push(q)}}catch(nt){$.e(nt)}finally{$.f()}}}catch(nt){P.e(nt)}finally{P.f()}if(0===j.length){var X,Y=y(r);try{for(Y.s();!(X=Y.n()).done;){var Z=X.value,tt=u.get(Z),et=D(Z,tt,s,c,o);h.push(et)}}catch(nt){Y.e(nt)}finally{Y.f()}}return h},w=function(t,e,n){for(var i=[],a=function(n){for(var a=[],r=0;r<t.length;++r)a.push({key:t[r],value:e[n][t[r]],num:0});a.length>0&&i.findIndex((function(t){for(var e=0;e<a.length;++e)if(t[e].value!==a[e].value||t[e].key!==a[e].key)return!1;return!0}))<0&&i.push(a)},r=0;r<e.length;++r)a(r);var s,l=y(n);try{var o=function(){for(var e=s.value,n=function(n){var a,r=y(i);try{var s=function(){var i=a.value;function r(){for(var a=0;a<=n;a++)if(i[a].value!==e[t[a]])return!1;return!0}r()&&(i[n].num+=e["cost"])};for(r.s();!(a=r.n()).done;)s()}catch(l){r.e(l)}finally{r.f()}},a=0;a<t.length;++a)n(a)};for(l.s();!(s=l.n()).done;)o()}catch(c){l.e(c)}finally{l.f()}return i.sort((function(t,e){function n(t){return"unknown"===t?4:"VO"===t?3:"AEO"===t?2:"MAI"===t?1:5}for(var i=0;i<t.length;++i)if(t[i].value!==e[i].value)return"mediabuy_type"===t[i].key?n(t[i].value)-n(e[i].value):"date"===t[i].key||"aeo_type"===t[i].key?null==t[i].value?1:null==e[i].value?-1:t[i].value>e[i].value?1:-1:e[i].num-t[i].num;return 1})),i},D=function(t,e,n,i,a){var r="",s=120,l=!1,o=!1,c=null;e&&null!==e&&(r=e.label,l=e.nosort,o=e.click,c=e.help);var u=n[t],d=!1;r&&null!==r&&""!==r||(r=t,r.indexOf("day")>=0&&(r=r.replace("d","D"),i&&(u=n[i]),d=!0));var f={title:r,key:t,width:s,sortable:"custom"};return l&&(f.sortable=!1),!0===o&&(f.render=function(e,n,i){return n.row[t]&&""!==n.row[t]?e("span",{style:{color:"#1890FF",cursor:"pointer"},on:{click:function(){a(n,t)}}},n.row[t]):e("span","无")}),u&&""!==u&&(f.render=d?function(t,e){if(Object(h["j"])(e.row[f.key]))return t("span","-");if(null==e.row[f.key]||Object(h["i"])(e.row[f.key]))return t("span","");if("retention"===i){var n=p()(e.row[f.key]).format(u),a="retention_users_"+f.key;if(null!=e.row[a]){var r=p()(e.row[a]).format("0,0");return t("div",[t("span",{style:"font-weight:bold"},n),"\n",t("span",r)])}return t("span",{style:"font-weight:bold"},n)}var s=p()(e.row[f.key]).format(u);return t("span",s)}:function(t,e){if(null==e.row[f.key])return t("span","");var n=p()(e.row[f.key]).format(u);return t("span",n)}),c&&(f.renderHeader=function(t,n){return t("span",[t("Poptip",{props:{content:e.help,placement:"top",transfer:!0,trigger:"hover",width:e.help_width,wordWrap:!0}},[t("Icon",{props:{type:"ios-help-circle-outline",size:16,color:"#2d8cf0"}})]),t("span",r)])}),f},_=n("9839"),O=(n("8dc2"),n("1157")),C=n.n(O);function S(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=T(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){l=!0,r=t},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw r}}}}function T(t,e){if(t){if("string"===typeof t)return k(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(t,e):void 0}}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var N={name:"MultiTitleTable",components:{ASelect:_["d"],Option:_["d"].Option},props:{data:{type:Array,default:function(){return[]}},footerData:{type:Array,default:function(){return[]}},pageData:{type:Object,default:function(){return{page_size:20,has_next:!1,has_prev:!1,total_num:20}}},knownFields:{type:Array,default:function(){return[]}},tableLoading:{type:Boolean,default:function(){return!1}},allDimensions:{type:Array,default:function(){return[]}},allMetrics:{type:Array,default:function(){return[]}},defaultDimensions:{type:Array,default:function(){return[]}},defaultTitleDimensions:{type:Array,default:function(){return[]}},defaultMetrics:{type:Array,default:function(){return[]}},haveIndex:{type:Boolean,default:function(){return!1}},defaultFormater:{type:String,default:function(){return"0,0"}},formater:{type:Object,default:function(){return{}}},dayRange:{type:Number,default:function(){return null}},currCohort:{type:String,default:function(){return null}},cohortType:{type:String,default:function(){return"grand_total"}},noSummery:{type:Boolean,default:function(){return!1}},noPage:{type:Boolean,default:function(){return!1}},tableIndex:{type:Number,default:function(){return 0}},tableHeight:{type:Number,default:function(){return 550}},dynamicHeight:{type:Boolean,default:function(){return!1}}},data:function(){return{sorting:!1,height:550,dimensions:[],titleDimensions:[],metrics:[],canSelectMetrics:[],tableColumns:[],allTableData:[],totalData:[],pageSizeOpts:[10,20,30,50]}},computed:{tableData:function(){var t=this.$refs["tablePages"];if(t){var e=this.$refs["tablePages"].currentPageSize,n=this.$refs["tablePages"].total,i=this.$refs["tablePages"].currentPage,a=(i-1)*e,r=a+e-1;r>n-1&&(r=n-1);var s=this.allTableData.slice(a,r+1);return s.length>0&&s.push({test_id:"1"}),s}var l=JSON.parse(JSON.stringify(this.allTableData));return l.length>0&&l.push({test_id:"1"}),l}},methods:{handleSortChange:function(t,e,n){var i=this;this.sorting=!0,setTimeout((function(){"asc"===t.order?i.allTableData.sort((function(e,n){var i=e[t.key],a=n[t.key];return null!=i&&isNaN(i)||null!=a&&isNaN(a)?(null==i&&(i="0"),null==a&&(a="0"),i>a?1:-1):(null==i&&(i=-1e7),null==a&&(a=-1e7),i-a)})):i.allTableData.sort((function(e,n){var i=e[t.key],a=n[t.key];return null!=i&&isNaN(i)||null!=a&&isNaN(a)?(null==i&&(i="0"),null==a&&(a="0"),a>i?1:-1):(null==i&&(i=-1e7),null==a&&(a=-1e7),a-i)})),i.sorting=!1}),5)},onClickCell:function(t,e){this.$emit("on-click-cell",t,e)},disabledDimension:function(t){return this.titleDimensions.indexOf(t.val)>=0},disabledTitleDimension:function(t){return this.dimensions.indexOf(t.val)>=0},handleRefresh:function(){this.$emit("on-table-refresh",this.dimensions,this.titleDimensions,this.metrics)},handleDownload:function(){var t=this;function e(t,n){return t.hasOwnProperty("children")?t.children.length<n+1?e(t.children[0],n):e(t.children[n],0):t.key}for(var n=[],i=0;i<this.tableColumns.length;++i)if(0===i)for(var a=0;a<this.dimensions.length;++a)n.push(e(this.tableColumns[0],a));else n.push(e(this.tableColumns[i],0));var r=[];function s(t,e,i,a){return 0===e?{title:t.title,key:n[i]}:t.children.length<a+1?s(t.children[0],e-1,i,a):s(t.children[a],e-1,i,a)}for(var l=0;l<=this.titleDimensions.length;++l){for(var o={},c=0;c<this.tableColumns.length;++c){var u={};if(0===c)for(var d=0;d<this.dimensions.length;++d)u=s(this.tableColumns[0],l,c+d,d),o[u.key]=u.title;else u=s(this.tableColumns[c],l,c+this.dimensions.length-1,0),o[u.key]=u.title}r.push(o)}var f=n.map((function(t){return{key:t}})),p=JSON.parse(JSON.stringify(this.allTableData));p=r.concat(p),p=p.concat(this.totalData);var y,m=S(p);try{for(m.s();!(y=m.n()).done;){var g=y.value;for(var b in g)Object(h["j"])(g[b])?g[b]="-":Object(h["i"])(g[b])&&(g[b]="")}}catch(D){m.e(D)}finally{m.f()}var v="overseas_aeo_new_users_"+this.knownFields.filter((function(e){return e.val===t.currCohort}))[0].label;v+="grand_total"===this.cohortType?"_culmulative_":"_onday_";var w=new Date;v+=w.toLocaleDateString(),v+="_"+Math.round(1e3*Math.random()),this.$refs.table.exportCsv({filename:v,columns:f,data:p,noHeader:!0})},handleDimensionsOrMetricsRefresh:function(){this.$emit("on-dimensions-or-metrics-refresh",this.dimensions,this.titleDimensions,this.metrics)},refreshHeight:function(){this.dynamicHeight?this.allTableData.length<=1?this.height=120+50*this.titleDimensions.length:this.allTableData.length<=3?this.height=220+50*this.titleDimensions.length:this.allTableData.length<=5?this.height=315+50*this.titleDimensions.length:this.allTableData.length<=7?this.height=415+50*this.titleDimensions.length:this.height=this.tableHeight:this.height=this.tableHeight},showTable:function(){return!!((this.tableColumns.length>0&&this.data.length)>0||this.tableLoading)},isLoading:function(){return this.tableLoading||this.sorting},getDimensionsAndMetrics:function(){return{dimensions:this.dimensions,titleDimensions:this.titleDimensions,metrics:this.metrics}},setDimensionsAndMetrics:function(t){this.dimensions=t.dimensions,this.titleDimensions=t.titleDimensions,this.metrics=t.metrics}},beforeMount:function(){this.tmpTag=this.searchTag},mounted:function(){var t=this;if(history.pushState(null,null,document.URL),window.addEventListener("popstate",(function(){history.pushState(null,null,document.URL)})),this.dimensions=JSON.parse(JSON.stringify(this.defaultDimensions)),this.titleDimensions=JSON.parse(JSON.stringify(this.defaultTitleDimensions)),this.canSelectMetrics=JSON.parse(JSON.stringify(this.allMetrics)),null!=this.dayRange)for(var e=0;e<=this.dayRange;++e)this.canSelectMetrics.push({val:"day"+e,label:"Day"+e});this.metrics=JSON.parse(JSON.stringify(this.defaultMetrics)),this.refreshHeight();var n=0;document.getElementsByClassName("ivu-table-body")[2*this.tableIndex].addEventListener("scroll",(function(e){var i=e.target.scrollLeft;n=e.target.scrollTop,C()(".ivu-table-body")[2*t.tableIndex+1].scrollLeft=i})),document.getElementsByClassName("ivu-table-body")[2*this.tableIndex+1].addEventListener("scroll",(function(e){var i=e.target.scrollLeft;C()(".ivu-table-body")[2*t.tableIndex].scrollLeft=i,C()(".ivu-table-body")[2*t.tableIndex].scrollTop=n})),this.noSummery&&C()((function(){C()(".topTable").addClass("hiddenTable")}))},watch:{data:function(t){if(this.dimensions.length>0){if(this.allTableData=b(this.titleDimensions,this.dimensions,this.metrics,this.data,this.currCohort),this.dimensions.length>0){var e={order:"asc",key:this.dimensions[0]};this.handleSortChange(e)}}else this.allTableData=[{}];this.refreshHeight()},footerData:function(t){if(this.totalData=b(this.titleDimensions,this.dimensions,this.metrics,this.footerData,this.currCohort),this.totalData.length>0){0===this.dimensions.length&&(this.totalData[0]["total"]="合计");for(var e=0;e<this.dimensions.length;++e)this.totalData[0][this.dimensions[e]]=0===e?"合计":"-"}},dayRange:function(t){var e=this,n=[];if(null!=this.dayRange)for(var i=0;i<=this.dayRange;++i)n.push({val:"day"+i,label:"Day"+i});this.canSelectMetrics=this.allMetrics.concat(n),this.metrics=this.metrics.filter((function(t){return t.indexOf("day")<0||parseInt(t.substring(3))<=e.dayRange}))},tableLoading:function(t){if(!1===t){var e=this;this.metrics.sort((function(t,n){return e.canSelectMetrics.findIndex((function(e){return e.val===t}))-e.canSelectMetrics.findIndex((function(t){return t.val===n}))})),this.tableColumns=v(this.titleDimensions,this.data,this.footerData,this.knownFields,this.dimensions,this.metrics,this.formater,this.haveIndex,this.onClickCell,this.currCohort)}var n=this.$refs["tablePages"];n&&!1===t&&(this.$refs["tablePages"].currentPage=1)}}},x=N,A=(n("c7c5"),n("2877")),j=Object(A["a"])(x,c,u,!1,null,null,null),M=j.exports,P=n("4481"),B=n("2f62");n("ca62");function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function R(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(Object(n),!0).forEach((function(e){Object(r["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var I={name:"aeo-cohort",components:{PageFilter:s["a"],LineChart:l["a"],TableData:o["a"],MultiTitleTable:M},data:function(){return{inited:!1,rowGutter:20,defaultDimensions:["date"],defaultTitleDimensions:["mediabuy_type"],knownDimensions:["date","app_name","media_source","country","audience_type","mediabuy_type","aeo_type","event_type"],defaultMetrics:["installs","average_cpi","day0","day3"],knownMetrics:["installs","cost","average_cpi"],inFields:[["projects","project"],["apps","app_id"],["mediaSources","media_source"],["countries","country"],["appTypes","app_type"],["audience","audience_type"],["mediabuy","mediabuy_type"],["aeo_type","aeo_type"],["event_type","event_type"]],knownCohorts:["roi","ad_revenue","iap_revenue","ads_arpu","ecpm","avimpression","click_ad_button","ad_show_fail","retention","staytime","enter_homepage"],knownCalculateBy:[{val:"installs",label:"Installs"},{val:"retention_users",label:"Active Users"},{val:"unique_users",label:"Engaged Users"}],currFilterApply:{},currDimensions:[],currTitleDimensions:[],currMetrics:[],currCohort:"roi",cohortType:"grand_total",disableDay:!1,disableTotal:!1,calculateBy:"installs",showCalculateBy:!1,tableLoading:!0,knownCalculateByArr:[]}},computed:R(R({},Object(B["d"])({field_formaters:function(t){return t.dashboard_field.field_formaters},aeo_cohort:function(t){return t.dashboard_field.abroad_cohort},allApp:function(t){return t.app_reporting.allApp},allMediaSource:function(t){return t.media_source.abroadMediaSource},tableData:function(t){if(!0===this.inited)return t.aeo_cohort.aeoCohortTableData.data},totalData:function(t){if(!0===this.inited){var e=t.aeo_cohort.aeoCohortTotalData.data;if(e&&e.length>0)return e}}})),{},{allDimensions:function(){return Object(d["j"])(this.aeo_cohort,this.knownDimensions)},allMetrics:function(){return Object(d["j"])(this.aeo_cohort,this.knownMetrics)},allCohorts:function(){return Object(d["j"])(this.aeo_cohort,this.knownCohorts)},dayRange:function(){return Object(d["f"])(this.currFilterApply,this.currDimensions.concat(this.currTitleDimensions))}}),methods:R(R({},Object(B["b"])(["getAeoCohortTableData","getAeoCohortTotalData"])),{},{onFilterApply:function(t){this.currFilterApply=JSON.parse(JSON.stringify(t)),this.updatePageData()},handleTableRefresh:function(t,e,n){this.currDimensions=JSON.parse(JSON.stringify(t)),this.currTitleDimensions=JSON.parse(JSON.stringify(e)),this.currMetrics=JSON.parse(JSON.stringify(n)),this.updatePageData()},handleDimensionsOrMetricsRefresh:function(t,e,n){this.currDimensions=JSON.parse(JSON.stringify(t)),this.currTitleDimensions=JSON.parse(JSON.stringify(e)),this.currMetrics=JSON.parse(JSON.stringify(n))},handleCohortChange:function(t){this.showRule(),this.updatePageData()},handleCalculateByChange:function(t){this.showRule(),this.updatePageData()},showRule:function(){this.knownCalculateByArr=this.knownCalculateBy,"retention"===this.currCohort?(this.showCalculateBy=!1,this.disableDay=!1,this.disableTotal=!0,this.cohortType="on_the_day"):"staytime"===this.currCohort||"avimpression"===this.currCohort||"click_ad_button"===this.currCohort||"ad_show_fail"===this.currCohort?(this.showCalculateBy=!0,"installs"===this.calculateBy?(this.disableDay=!1,this.disableTotal=!1):(this.disableDay=!1,this.disableTotal=!0,this.cohortType="on_the_day")):"enter_homepage"===this.currCohort?(this.knownCalculateByArr=this.knownCalculateBy.filter((function(t){return"unique_users"!==t.val})),this.showCalculateBy=!0,this.disableDay=!1,this.disableTotal=!0,this.cohortType="on_the_day","unique_users"===this.calculateBy&&(this.calculateBy="installs")):(this.showCalculateBy=!1,this.disableDay=!1,this.disableTotal=!1,this.knownCalculateByArr=this.knownCalculateBy)},handleCohoreTypeChange:function(t){this.updatePageData()},setDefaultDimensionsAndMetrics:function(){var t=JSON.stringify(this.defaultDimensions);this.currDimensions=JSON.parse(t),t=JSON.stringify(this.defaultTitleDimensions),this.currTitleDimensions=JSON.parse(t),t=JSON.stringify(this.defaultMetrics),this.currMetrics=JSON.parse(t)},updatePageData:function(){var t=this;this.tableLoading=!0,Promise.all([this.getAeoCohortTableData(this.wrapTableReqParams()),this.getAeoCohortTotalData(this.wrapTotalReqParams())]).then((function(e){t.inited=!0,t.tableLoading=!1})).catch((function(e){t.tableLoading=!1,t.showError(e)}))},wrapTableReqParams:function(){var t={time_range:Object(d["r"])(this.currFilterApply),filtering:Object(d["m"])(this.currFilterApply,this.inFields),group_by:Object(d["n"])(this.currDimensions.concat(this.currTitleDimensions)),fields:Object(d["l"])(this.knownMetrics),show_type:this.currCohort,statistic_type:this.cohortType,calculate_by:this.calculateBy,pageAeo:!0};return t},wrapTotalReqParams:function(){var t={time_range:Object(d["r"])(this.currFilterApply),filtering:Object(d["m"])(this.currFilterApply,this.inFields),group_by:Object(d["n"])(this.currTitleDimensions),fields:Object(d["l"])(this.knownMetrics),show_type:this.currCohort,statistic_type:this.cohortType,calculate_by:this.calculateBy,pageAeo:!0};return t},showError:function(t){this.$Modal.error({title:"Error",content:t})},onSelectPageInfo:function(t){var e=JSON.parse(t);this.$refs.pageFilter.setFilter(e.filter),this.currCohort=e.currCohort,this.cohortType=e.cohortType,this.calculateBy=e.calculateBy,this.$refs.table.setDimensionsAndMetrics(e.dimensions),this.currDimensions=JSON.parse(JSON.stringify(e.dimensions.dimensions)),this.currTitleDimensions=JSON.parse(JSON.stringify(e.dimensions.titleDimensions)),this.currMetrics=JSON.parse(JSON.stringify(e.dimensions.metrics)),e.filter.time_type&&(e.filter.rangeDates=Object(h["f"])(e.filter.time_type)),this.showRule(),this.onFilterApply(e.filter)},onGetPageInfo:function(t){var e=this.$refs.pageFilter.getFilter(),n=this.$refs.table.getDimensionsAndMetrics(),i=JSON.stringify({filter:e,currCohort:this.currCohort,calculateBy:this.calculateBy,cohortType:this.cohortType,dimensions:n});P["a"].$emit("setPageInfo",t,i)}}),mounted:function(){this.setDefaultDimensionsAndMetrics(),this.updatePageData();var t=this;P["a"].$on("selectPageInfo",(function(e){t.onSelectPageInfo(e)})),P["a"].$on("getPageInfo",(function(e){t.onGetPageInfo(e)}))},beforeDestroy:function(){P["a"].$off("selectPageInfo"),P["a"].$off("getPageInfo")}},L=I,F=(n("fca0"),Object(A["a"])(L,i,a,!1,null,"18a5c33a",null));e["default"]=F.exports},9971:function(t,e,n){},c7c5:function(t,e,n){"use strict";n("9971")},d087:function(t,e,n){},fca0:function(t,e,n){"use strict";n("d087")}}]);